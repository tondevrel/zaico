<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zaico Chatbot Demo - AI Assistant</title>
    
    <!-- React and ReactDOM from CDN -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel for JSX transformation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- DaisyUI CSS -->
    <link href="https://cdn.jsdelivr.net/npm/daisyui@4.4.19/dist/full.min.css" rel="stylesheet" type="text/css" />
    
    <style>
        :root {
            --primary-bg: #362F4B;
            --secondary-bg: #4A3F5F;
            --accent-color: #C5B4E3;
            --text-light: #E8E0F0;
            --text-muted: #B8A8C8;
            --card-bg: #2A2338;
            --border-color: #5A4F6F;
        }
        
        body {
            background-color: var(--primary-bg) !important;
        }
        
        .typing-animation {
            animation: typing 1.5s infinite;
        }
        
        @keyframes typing {
            0%, 60%, 100% { opacity: 0.3; }
            30% { opacity: 1; }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .slide-up {
            animation: slideUp 0.3s ease-out;
        }
        
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .slide-in-left {
            animation: slideInLeft 0.6s ease-out;
        }
        
        @keyframes slideInLeft {
            from { opacity: 0; transform: translateX(-30px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .slide-in-right {
            animation: slideInRight 0.6s ease-out;
        }
        
        @keyframes slideInRight {
            from { opacity: 0; transform: translateX(30px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .scale-in {
            animation: scaleIn 0.4s ease-out;
        }
        
        @keyframes scaleIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        .pulse-glow {
            animation: pulseGlow 2s infinite;
        }
        
        @keyframes pulseGlow {
            0%, 100% { box-shadow: 0 0 5px rgba(197, 180, 227, 0.3); }
            50% { box-shadow: 0 0 20px rgba(197, 180, 227, 0.6); }
        }
        
        /* Custom dark purple theme */
        .custom-bg {
            background-color: var(--primary-bg);
        }
        
        .custom-card {
            background-color: var(--card-bg);
            border: 1px solid var(--border-color);
        }
        
        .custom-text {
            color: var(--text-light);
        }
        
        .custom-text-muted {
            color: var(--text-muted);
        }
        
        .custom-accent {
            color: var(--accent-color);
        }
        
        .custom-btn {
            background-color: var(--secondary-bg);
            border-color: var(--border-color);
            color: var(--text-light);
        }
        
        .custom-btn:hover {
            background-color: var(--accent-color);
            color: var(--primary-bg);
        }
        
        .custom-input {
            background-color: var(--card-bg);
            border-color: var(--border-color);
            color: var(--text-light);
        }
        
        .custom-input::placeholder {
            color: var(--text-muted);
        }
        
        .custom-chat-bubble {
            background-color: var(--secondary-bg);
            color: var(--text-light);
        }
        
        .custom-user-bubble {
            background-color: var(--accent-color);
            color: var(--primary-bg);
        }
    </style>
</head>
<body class="bg-base-200 min-h-screen">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Main App Component
        function ZaicoChatbot() {
            const [messages, setMessages] = useState([]);
            const [isTyping, setIsTyping] = useState(false);
            const [currentStep, setCurrentStep] = useState('landing');
            const [userData, setUserData] = useState({});
            const [customMessage, setCustomMessage] = useState('');
            const [remainingMinutes, setRemainingMinutes] = useState(10);
            const [currentNumber, setCurrentNumber] = useState('+1 (555) 123-4567');
            const [showTranscription, setShowTranscription] = useState(false);
            const [transcriptionData, setTranscriptionData] = useState(null);
            const [showUpgrade, setShowUpgrade] = useState(false);
            const [isProcessing, setIsProcessing] = useState(false);
            const [processingStep, setProcessingStep] = useState('');
            const [processingProgress, setProcessingProgress] = useState(0);
            const [currentSlide, setCurrentSlide] = useState(0);
            const [showProfile, setShowProfile] = useState(false);
            const [pendingBooking, setPendingBooking] = useState(null); // Store pending booking info
            const pendingBookingRef = useRef(null); // Store pending booking info in ref for immediate access
            const messagesEndRef = useRef(null);

            // User data storage
            const [userProfile, setUserProfile] = useState({
                personalInfo: {
                    name: '',
                    email: '',
                    phone: '',
                    location: '',
                    dateOfBirth: '',
                    emergencyContact: ''
                },
                paymentInfo: {
                    cardNumber: '',
                    expiryDate: '',
                    cvv: '',
                    cardName: '',
                    billingAddress: ''
                },
                preferences: {
                    preferredLanguage: 'English',
                    notificationSettings: {
                        email: true,
                        sms: true,
                        push: false
                    },
                    serviceHistory: []
                },
                subscription: {
                    plan: 'Basic',
                    minutesUsed: 0,
                    minutesRemaining: 10,
                    nextBilling: '2024-02-15'
                }
            });

            const scrollToBottom = () => {
                messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
            };

            // Slide navigation functions
            const nextSlide = () => {
                setCurrentSlide(prev => Math.min(prev + 1, 11)); // 12 slides total (0-11)
            };

            const prevSlide = () => {
                setCurrentSlide(prev => Math.max(prev - 1, 0));
            };

            const goToSlide = (slideIndex) => {
                setCurrentSlide(slideIndex);
            };

            // Show payment success animation
            const showPaymentSuccess = (message) => {
                // Add green success message
                addMessage("✅ Payment successful!", 'system');
                setTimeout(() => {
                    addMessageWithTyping(message);
                }, 1000);
            };

            // Start demo function
            const startDemo = () => {
                setCurrentStep('intro');
                setTimeout(() => {
                    addMessage("I understand that it's hard for you to call places and arrange things. Phone anxiety is real, and you're not alone.");
                }, 500);
                setTimeout(() => {
                    addMessageWithTyping("I'm your AI concierge, designed to eliminate phone calls from your life forever. I'll handle all the calling, booking, and arranging for you.");
                }, 2000);
                setTimeout(() => {
                    const initialButtons = (
                        <div className="space-y-3 mt-3">
                            <button 
                                className="custom-btn btn w-full"
                                onClick={() => handleScenarioSelect("booking")}
                            >
                                Book a service
                            </button>
                            <button 
                                className="custom-btn btn w-full"
                                onClick={() => handleScenarioSelect("calling")}
                            >
                                Call someone
                            </button>
                        </div>
                    );
                    addMessage("What would you like me to help you with today?", 'system', null, initialButtons);
                }, 4000);
            };

            useEffect(() => {
                scrollToBottom();
            }, [messages]);

            // Simple message adding function
            const addMessage = (text, type = 'system', content = null, buttons = null) => {
                setMessages(prev => [...prev, {
                    id: Date.now(),
                    type: type,
                    text: text,
                    content: content, // For cards, forms, etc.
                    buttons: buttons, // For action buttons
                    timestamp: new Date()
                }]);
            };

            // Simulate typing animation
            const addMessageWithTyping = (text, delay = 1500) => {
                setIsTyping(true);
                setTimeout(() => {
                    setIsTyping(false);
                    addMessage(text, 'system');
                }, delay);
            };

            // Initialize chat

            // Handle scenario selection
            const handleScenarioSelect = (scenario) => {
                addMessage(scenario, 'user');
                
                if (scenario === "booking") {
                    setTimeout(() => {
                        const serviceButtons = (
                            <div className="grid grid-cols-2 gap-2 mt-3">
                                <button 
                                    className="custom-btn btn btn-sm"
                                    onClick={() => handleServiceTypeSelect("Medical Center")}
                                >
                                    Medical Center
                                </button>
                                <button 
                                    className="custom-btn btn btn-sm"
                                    onClick={() => handleServiceTypeSelect("Education Services")}
                                >
                                    Education
                                </button>
                                <button 
                                    className="custom-btn btn btn-sm"
                                    onClick={() => handleServiceTypeSelect("Housing & Utilities")}
                                >
                                    Housing & Utilities
                                </button>
                                <button 
                                    className="custom-btn btn btn-sm"
                                    onClick={() => handleServiceTypeSelect("Travel Services")}
                                >
                                    Travel Services
                                </button>
                                <button 
                                    className="custom-btn btn btn-sm"
                                    onClick={() => handleServiceTypeSelect("Government Services")}
                                >
                                    Government
                                </button>
                                <button 
                                    className="custom-btn btn btn-sm"
                                    onClick={() => handleServiceTypeSelect("Courier Services")}
                                >
                                    Courier & Delivery
                                </button>
                                <button 
                                    className="custom-btn btn btn-sm"
                                    onClick={() => handleServiceTypeSelect("Repair Services")}
                                >
                                    Repair Services
                                </button>
                                <button 
                                    className="custom-btn btn btn-sm"
                                    onClick={() => handleServiceTypeSelect("Restaurant Reservation")}
                                >
                                    Restaurant
                                </button>
                            </div>
                        );
                        addMessage("I'll help you book a service. What type of service do you need?", 'system', null, serviceButtons);
                        setCurrentStep('service-selection');
                    }, 1000);
                } else if (scenario === "calling") {
                    setTimeout(() => {
                        const callButtons = (
                            <div className="grid grid-cols-2 gap-2 mt-3">
                                <button 
                                    className="custom-btn btn btn-sm"
                                    onClick={() => handleCallTypeSelect("Customer Support")}
                                >
                                    Customer Support
                                </button>
                                <button 
                                    className="custom-btn btn btn-sm"
                                    onClick={() => handleCallTypeSelect("Personal Call")}
                                >
                                    Personal Call
                                </button>
                                <button 
                                    className="custom-btn btn btn-sm"
                                    onClick={() => handleCallTypeSelect("Business Call")}
                                >
                                    Business Call
                                </button>
                                <button 
                                    className="custom-btn btn btn-sm"
                                    onClick={() => handleCallTypeSelect("Complaint Call")}
                                >
                                    Complaint Call
                                </button>
                                <button 
                                    className="custom-btn btn btn-sm"
                                    onClick={() => handleCallTypeSelect("Invite girlfriend to movies")}
                                >
                                    Invite girlfriend to movies
                                </button>
                                <button 
                                    className="custom-btn btn btn-sm"
                                    onClick={() => handleCallTypeSelect("Cancel Subscription")}
                                >
                                    Cancel Subscription
                                </button>
                            </div>
                        );
                        addMessage("I can make calls for you! What type of call do you need me to make?", 'system', null, callButtons);
                        setCurrentStep('call-selection');
                    }, 1000);
                } else {
                    setTimeout(() => {
                        addMessageWithTyping("I'll help you with that. Let me get some details first.");
                    }, 1000);
                }
            };

            // Handle specific service selection
            const handleServiceTypeSelect = (serviceType) => {
                addMessage(serviceType, 'user');
                
                // Medical Center scenarios
                if (serviceType === "Medical Center") {
                    setTimeout(() => {
                        const medicalButtons = (
                            <div className="grid grid-cols-2 gap-2 mt-3">
                                <button 
                                    className="custom-btn btn btn-sm"
                                    onClick={() => handleMedicalTaskSelect("Book Appointment")}
                                >
                                    Book Appointment
                                </button>
                                <button 
                                    className="custom-btn btn btn-sm"
                                    onClick={() => handleMedicalTaskSelect("Lab Results")}
                                >
                                    Lab Results
                                </button>
                                <button 
                                    className="custom-btn btn btn-sm"
                                    onClick={() => handleMedicalTaskSelect("Schedule Test")}
                                >
                                    Schedule Test
                                </button>
                                <button 
                                    className="custom-btn btn btn-sm"
                                    onClick={() => handleMedicalTaskSelect("Prescription Refill")}
                                >
                                    Prescription Refill
                                </button>
                            </div>
                        );
                        addMessage("I'll help you with medical services. What do you need to do?", 'system', null, medicalButtons);
                    }, 1000);
                } else if (serviceType === "Doctor Appointment") {
                    setTimeout(() => {
                        const doctorTypeButtons = (
                            <div className="grid grid-cols-2 gap-2 mt-3">
                                <button 
                                    className="custom-btn btn btn-sm"
                                    onClick={() => handleDoctorTypeSelect("General Practitioner")}
                                >
                                    General Practitioner
                                </button>
                                <button 
                                    className="custom-btn btn btn-sm"
                                    onClick={() => handleDoctorTypeSelect("Dentist")}
                                >
                                    Dentist
                                </button>
                                <button 
                                    className="custom-btn btn btn-sm"
                                    onClick={() => handleDoctorTypeSelect("Dermatologist")}
                                >
                                    Dermatologist
                                </button>
                                <button 
                                    className="custom-btn btn btn-sm"
                                    onClick={() => handleDoctorTypeSelect("Cardiologist")}
                                >
                                    Cardiologist
                                </button>
                                <button 
                                    className="custom-btn btn btn-sm"
                                    onClick={() => handleDoctorTypeSelect("Psychiatrist")}
                                >
                                    Psychiatrist
                                </button>
                                <button 
                                    className="custom-btn btn btn-sm"
                                    onClick={() => handleDoctorTypeSelect("Other Specialist")}
                                >
                                    Other Specialist
                                </button>
                            </div>
                        );
                        addMessage("What type of doctor do you need to see?", 'system', null, doctorTypeButtons);
                    }, 1000);
                } else if (serviceType === "Restaurant Reservation") {
                    setTimeout(() => {
                        const restaurantForm = (
                            <div className="custom-card p-4 mt-2">
                                <h3 className="font-bold custom-accent mb-3">Restaurant Preferences</h3>
                                <form onSubmit={(e) => {
                                    e.preventDefault();
                                    const restaurantData = {
                                        cuisine: e.target.cuisine.value,
                                        guests: e.target.guests.value,
                                        date: e.target.date.value,
                                        time: e.target.time.value,
                                        occasion: e.target.occasion.value,
                                        budget: e.target.budget.value,
                                        location: e.target.location.value
                                    };
                                    handleRestaurantSubmit(restaurantData);
                                }}>
                                    <div className="space-y-3">
                                        <select name="cuisine" className="select select-bordered w-full custom-input" defaultValue="Italian" required>
                                            <option value="">Select cuisine type</option>
                                            <option value="Italian">Italian</option>
                                            <option value="French">French</option>
                                            <option value="Asian">Asian</option>
                                            <option value="American">American</option>
                                            <option value="Mexican">Mexican</option>
                                            <option value="Mediterranean">Mediterranean</option>
                                            <option value="Indian">Indian</option>
                                            <option value="Japanese">Japanese</option>
                                        </select>
                                        <select name="guests" className="select select-bordered w-full custom-input" defaultValue="2" required>
                                            <option value="">Number of guests</option>
                                            <option value="1">1 person</option>
                                            <option value="2">2 people</option>
                                            <option value="3">3 people</option>
                                            <option value="4">4 people</option>
                                            <option value="5">5 people</option>
                                            <option value="6+">6+ people</option>
                                        </select>
                                        <input type="date" name="date" className="input input-bordered w-full custom-input" defaultValue={new Date(Date.now() + 24*60*60*1000).toISOString().split('T')[0]} required />
                                        <select name="time" className="select select-bordered w-full custom-input" defaultValue="19:00" required>
                                            <option value="">Select time</option>
                                            <option value="17:00">5:00 PM</option>
                                            <option value="17:30">5:30 PM</option>
                                            <option value="18:00">6:00 PM</option>
                                            <option value="18:30">6:30 PM</option>
                                            <option value="19:00">7:00 PM</option>
                                            <option value="19:30">7:30 PM</option>
                                            <option value="20:00">8:00 PM</option>
                                            <option value="20:30">8:30 PM</option>
                                            <option value="21:00">9:00 PM</option>
                                        </select>
                                        <select name="occasion" className="select select-bordered w-full custom-input" defaultValue="Date" required>
                                            <option value="">Select occasion</option>
                                            <option value="Date">Romantic Date</option>
                                            <option value="Business">Business Meeting</option>
                                            <option value="Family">Family Dinner</option>
                                            <option value="Celebration">Celebration</option>
                                            <option value="Casual">Casual Dining</option>
                                        </select>
                                        <select name="budget" className="select select-bordered w-full custom-input" defaultValue="$30-50" required>
                                            <option value="">Budget per person</option>
                                            <option value="$20-30">$20-30</option>
                                            <option value="$30-50">$30-50</option>
                                            <option value="$50-80">$50-80</option>
                                            <option value="$80+">$80+</option>
                                        </select>
                                        <input 
                                            type="text" 
                                            name="location"
                                            placeholder="Your location (e.g., Manhattan, Brooklyn, Queens)" 
                                            className="input input-bordered w-full custom-input" 
                                            defaultValue={userProfile.personalInfo.location || "New York, NY"}
                                            required 
                                        />
                                        <button type="submit" className="custom-btn btn btn-sm w-full">Continue to Contact Info</button>
                                    </div>
                                </form>
                            </div>
                        );
                        addMessage("Great! Let me get your restaurant preferences first.", 'system', restaurantForm);
                    }, 1000);
                } else if (serviceType === "Cleaning Service") {
                    setTimeout(() => {
                        const cleaningForm = (
                            <div className="custom-card p-4 mt-2">
                                <h3 className="font-bold custom-accent mb-3">Cleaning Service Details</h3>
                                <form onSubmit={(e) => {
                                    e.preventDefault();
                                    const cleaningData = {
                                        serviceType: e.target.serviceType.value,
                                        propertySize: e.target.propertySize.value,
                                        frequency: e.target.frequency.value,
                                        specialRequests: e.target.specialRequests.value,
                                        budget: e.target.budget.value,
                                        urgency: e.target.urgency.value,
                                        accessInstructions: e.target.accessInstructions.value,
                                        location: e.target.location.value
                                    };
                                    handleCleaningSubmit(cleaningData);
                                }}>
                                    <div className="space-y-3">
                                        <select name="serviceType" className="select select-bordered w-full custom-input" defaultValue="Deep Clean" required>
                                            <option value="">Select cleaning type</option>
                                            <option value="Regular Clean">Regular Clean</option>
                                            <option value="Deep Clean">Deep Clean</option>
                                            <option value="Move-in/Move-out">Move-in/Move-out</option>
                                            <option value="Post-Construction">Post-Construction</option>
                                            <option value="Office Clean">Office Clean</option>
                                            <option value="Airbnb Turnover">Airbnb Turnover</option>
                                        </select>
                                        <select name="propertySize" className="select select-bordered w-full custom-input" defaultValue="2-3 Bedrooms" required>
                                            <option value="">Property size</option>
                                            <option value="Studio/1BR">Studio/1 Bedroom</option>
                                            <option value="2-3 Bedrooms">2-3 Bedrooms</option>
                                            <option value="4-5 Bedrooms">4-5 Bedrooms</option>
                                            <option value="6+ Bedrooms">6+ Bedrooms</option>
                                            <option value="Office Space">Office Space</option>
                                        </select>
                                        <select name="frequency" className="select select-bordered w-full custom-input" defaultValue="One-time" required>
                                            <option value="">Cleaning frequency</option>
                                            <option value="One-time">One-time</option>
                                            <option value="Weekly">Weekly</option>
                                            <option value="Bi-weekly">Bi-weekly</option>
                                            <option value="Monthly">Monthly</option>
                                        </select>
                                        <select name="urgency" className="select select-bordered w-full custom-input" defaultValue="Within 3 days" required>
                                            <option value="">How soon do you need it?</option>
                                            <option value="Today">Today (Emergency)</option>
                                            <option value="Tomorrow">Tomorrow</option>
                                            <option value="Within 3 days">Within 3 days</option>
                                            <option value="This week">This week</option>
                                            <option value="Flexible">Flexible</option>
                                        </select>
                                        <select name="budget" className="select select-bordered w-full custom-input" defaultValue="$100-200" required>
                                            <option value="">Budget range</option>
                                            <option value="$50-100">$50-100</option>
                                            <option value="$100-200">$100-200</option>
                                            <option value="$200-300">$200-300</option>
                                            <option value="$300-500">$300-500</option>
                                            <option value="$500+">$500+</option>
                                        </select>
                                        <textarea 
                                            name="specialRequests"
                                            placeholder="Special requests (pets, allergies, specific areas, etc.)" 
                                            className="textarea textarea-bordered w-full custom-input" 
                                            rows="3"
                                            defaultValue="Please avoid strong chemicals, I have a cat"
                                        />
                                        <input 
                                            type="text" 
                                            name="location"
                                            placeholder="Your location (e.g., Manhattan, Brooklyn, Queens)" 
                                            className="input input-bordered w-full custom-input" 
                                            defaultValue={userProfile.personalInfo.location || "New York, NY"}
                                            required 
                                        />
                                        <textarea 
                                            name="accessInstructions"
                                            placeholder="Access instructions (key location, door codes, etc.)" 
                                            className="textarea textarea-bordered w-full custom-input" 
                                            rows="2"
                                            defaultValue="Key under the doormat, please ring doorbell first"
                                        />
                                        <button type="submit" className="custom-btn btn btn-sm w-full">Get Cleaning Quotes</button>
                                    </div>
                                </form>
                            </div>
                        );
                        addMessage("I'll help you find the perfect cleaning service! Let me get some details about your needs.", 'system', cleaningForm);
                    }, 1000);
                } else if (serviceType === "Beauty Salon") {
                    setTimeout(() => {
                        const beautyForm = (
                            <div className="custom-card p-4 mt-2">
                                <h3 className="font-bold custom-accent mb-3">Beauty Service Preferences</h3>
                                <form onSubmit={(e) => {
                                    e.preventDefault();
                                    const beautyData = {
                                        serviceType: e.target.serviceType.value,
                                        hairLength: e.target.hairLength.value,
                                        hairType: e.target.hairType.value,
                                        occasion: e.target.occasion.value,
                                        budget: e.target.budget.value,
                                        urgency: e.target.urgency.value,
                                        previousExperience: e.target.previousExperience.value,
                                        location: e.target.location.value
                                    };
                                    handleBeautySubmit(beautyData);
                                }}>
                                    <div className="space-y-3">
                                        <select name="serviceType" className="select select-bordered w-full custom-input" defaultValue="Haircut & Style" required>
                                            <option value="">Select service</option>
                                            <option value="Haircut & Style">Haircut & Style</option>
                                            <option value="Hair Color">Hair Color</option>
                                            <option value="Highlights">Highlights</option>
                                            <option value="Perm/Straightening">Perm/Straightening</option>
                                            <option value="Bridal Package">Bridal Package</option>
                                            <option value="Manicure/Pedicure">Manicure/Pedicure</option>
                                            <option value="Facial Treatment">Facial Treatment</option>
                                            <option value="Eyebrow/Lash">Eyebrow/Lash Service</option>
                                        </select>
                                        <select name="hairLength" className="select select-bordered w-full custom-input" defaultValue="Shoulder Length" required>
                                            <option value="">Hair length</option>
                                            <option value="Short (Above shoulders)">Short (Above shoulders)</option>
                                            <option value="Shoulder Length">Shoulder Length</option>
                                            <option value="Long (Below shoulders)">Long (Below shoulders)</option>
                                            <option value="Very Long (Below waist)">Very Long (Below waist)</option>
                                        </select>
                                        <select name="hairType" className="select select-bordered w-full custom-input" defaultValue="Straight" required>
                                            <option value="">Hair type</option>
                                            <option value="Straight">Straight</option>
                                            <option value="Wavy">Wavy</option>
                                            <option value="Curly">Curly</option>
                                            <option value="Coily">Coily</option>
                                            <option value="Chemically Treated">Chemically Treated</option>
                                        </select>
                                        <select name="occasion" className="select select-bordered w-full custom-input" defaultValue="Regular Maintenance" required>
                                            <option value="">Occasion</option>
                                            <option value="Regular Maintenance">Regular Maintenance</option>
                                            <option value="Special Event">Special Event</option>
                                            <option value="Wedding">Wedding</option>
                                            <option value="Job Interview">Job Interview</option>
                                            <option value="Date Night">Date Night</option>
                                            <option value="Holiday Party">Holiday Party</option>
                                        </select>
                                        <select name="urgency" className="select select-bordered w-full custom-input" defaultValue="This week" required>
                                            <option value="">How soon do you need it?</option>
                                            <option value="Today">Today (Emergency)</option>
                                            <option value="Tomorrow">Tomorrow</option>
                                            <option value="This week">This week</option>
                                            <option value="Next week">Next week</option>
                                            <option value="Flexible">Flexible</option>
                                        </select>
                                        <select name="budget" className="select select-bordered w-full custom-input" defaultValue="$80-150" required>
                                            <option value="">Budget range</option>
                                            <option value="$30-60">$30-60</option>
                                            <option value="$60-100">$60-100</option>
                                            <option value="$100-150">$100-150</option>
                                            <option value="$150-250">$150-250</option>
                                            <option value="$250+">$250+</option>
                                        </select>
                                        <input 
                                            type="text" 
                                            name="location"
                                            placeholder="Your location (e.g., Manhattan, Brooklyn, Queens)" 
                                            className="input input-bordered w-full custom-input" 
                                            defaultValue={userProfile.personalInfo.location || "New York, NY"}
                                            required 
                                        />
                                        <textarea 
                                            name="previousExperience"
                                            placeholder="Previous salon experience, preferences, or concerns" 
                                            className="textarea textarea-bordered w-full custom-input" 
                                            rows="2"
                                            defaultValue="Looking for someone experienced with curly hair, last stylist cut too much"
                                        />
                                        <button type="submit" className="custom-btn btn btn-sm w-full">Find Beauty Services</button>
                                    </div>
                                </form>
                            </div>
                        );
                        addMessage("I'll help you find the perfect beauty service! Let me get some details about what you're looking for.", 'system', beautyForm);
                    }, 1000);
                } else if (serviceType === "Taxi/Ride") {
                    setTimeout(() => {
                        const taxiForm = (
                            <div className="custom-card p-4 mt-2">
                                <h3 className="font-bold custom-accent mb-3">Ride Service Details</h3>
                                <form onSubmit={(e) => {
                                    e.preventDefault();
                                    const taxiData = {
                                        rideType: e.target.rideType.value,
                                        pickupLocation: e.target.pickupLocation.value,
                                        destination: e.target.destination.value,
                                        passengers: e.target.passengers.value,
                                        luggage: e.target.luggage.value,
                                        urgency: e.target.urgency.value,
                                        specialRequests: e.target.specialRequests.value
                                    };
                                    handleTaxiSubmit(taxiData);
                                }}>
                                    <div className="space-y-3">
                                        <select name="rideType" className="select select-bordered w-full custom-input" defaultValue="Standard" required>
                                            <option value="">Select ride type</option>
                                            <option value="Standard">Standard Ride</option>
                                            <option value="Premium">Premium/Luxury</option>
                                            <option value="Airport">Airport Transfer</option>
                                            <option value="Hourly">Hourly Service</option>
                                            <option value="Group">Group/Party Bus</option>
                                            <option value="Wheelchair Accessible">Wheelchair Accessible</option>
                                        </select>
                                        <input 
                                            type="text" 
                                            name="pickupLocation"
                                            placeholder="Pickup location" 
                                            className="input input-bordered w-full custom-input" 
                                            defaultValue="123 Main St, Downtown"
                                            required 
                                        />
                                        <input 
                                            type="text" 
                                            name="destination"
                                            placeholder="Destination" 
                                            className="input input-bordered w-full custom-input" 
                                            defaultValue="JFK Airport"
                                            required 
                                        />
                                        <select name="passengers" className="select select-bordered w-full custom-input" defaultValue="1" required>
                                            <option value="">Number of passengers</option>
                                            <option value="1">1 passenger</option>
                                            <option value="2">2 passengers</option>
                                            <option value="3">3 passengers</option>
                                            <option value="4">4 passengers</option>
                                            <option value="5+">5+ passengers</option>
                                        </select>
                                        <select name="luggage" className="select select-bordered w-full custom-input" defaultValue="None" required>
                                            <option value="">Luggage</option>
                                            <option value="None">No luggage</option>
                                            <option value="Small bags">Small bags (1-2)</option>
                                            <option value="Suitcases">Suitcases (1-2)</option>
                                            <option value="Large luggage">Large luggage (3+)</option>
                                            <option value="Oversized">Oversized items</option>
                                        </select>
                                        <select name="urgency" className="select select-bordered w-full custom-input" defaultValue="ASAP" required>
                                            <option value="">When do you need the ride?</option>
                                            <option value="ASAP">ASAP (Emergency)</option>
                                            <option value="Within 30 min">Within 30 minutes</option>
                                            <option value="Within 1 hour">Within 1 hour</option>
                                            <option value="Scheduled">Scheduled pickup</option>
                                            <option value="Flexible">Flexible timing</option>
                                        </select>
                                        <textarea 
                                            name="specialRequests"
                                            placeholder="Special requests (child seat, pet-friendly, etc.)" 
                                            className="textarea textarea-bordered w-full custom-input" 
                                            rows="2"
                                            defaultValue="Need child car seat for 3-year-old"
                                        />
                                        <button type="submit" className="custom-btn btn btn-sm w-full">Find Ride Options</button>
                                    </div>
                                </form>
                            </div>
                        );
                        addMessage("I'll help you find the perfect ride! Let me get some details about your trip.", 'system', taxiForm);
                    }, 1000);
                } else {
                    setCurrentStep('contact-form');
                    showContactForm(serviceType);
                }
            };

            // Handle medical task selection
            const handleMedicalTaskSelect = (task) => {
                addMessage(task, 'user');
                
                if (task === "Book Appointment") {
                    setTimeout(() => {
                        const appointmentForm = (
                            <div className="custom-card p-4 mt-2">
                                <h3 className="font-bold custom-accent mb-3">Medical Appointment Details</h3>
                                <form onSubmit={(e) => {
                                    e.preventDefault();
                                    const appointmentData = {
                                        specialist: e.target.specialist.value,
                                        urgency: e.target.urgency.value,
                                        symptoms: e.target.symptoms.value,
                                        insurance: e.target.insurance.value,
                                        location: e.target.location.value,
                                        preferredDate: e.target.preferredDate.value,
                                        preferredTime: e.target.preferredTime.value
                                    };
                                    handleMedicalAppointment(appointmentData);
                                }}>
                                    <div className="space-y-3">
                                        <select name="specialist" className="select select-bordered w-full custom-input" defaultValue="General Practitioner" required>
                                            <option value="">Select specialist</option>
                                            <option value="General Practitioner">General Practitioner</option>
                                            <option value="Cardiologist">Cardiologist</option>
                                            <option value="Dermatologist">Dermatologist</option>
                                            <option value="Gynecologist">Gynecologist</option>
                                            <option value="Orthopedist">Orthopedist</option>
                                            <option value="Neurologist">Neurologist</option>
                                            <option value="Psychiatrist">Psychiatrist</option>
                                        </select>
                                        <select name="urgency" className="select select-bordered w-full custom-input" defaultValue="Routine" required>
                                            <option value="">Urgency level</option>
                                            <option value="Routine">Routine checkup</option>
                                            <option value="Urgent">Urgent (within a week)</option>
                                            <option value="Emergency">Emergency (same day)</option>
                                        </select>
                                        <textarea 
                                            name="symptoms"
                                            placeholder="Brief description of symptoms or reason for visit" 
                                            className="textarea textarea-bordered w-full custom-input" 
                                            rows="3"
                                            defaultValue="Annual checkup and some chest pain"
                                        />
                                        <input 
                                            type="text" 
                                            name="insurance"
                                            placeholder="Insurance provider" 
                                            className="input input-bordered w-full custom-input" 
                                            defaultValue="Standard Insurance"
                                            required 
                                        />
                                        <input 
                                            type="text" 
                                            name="location"
                                            placeholder="Your location (e.g., Manhattan, Brooklyn, Queens)" 
                                            className="input input-bordered w-full custom-input" 
                                            defaultValue={userProfile.personalInfo.location || "New York, NY"}
                                            required 
                                        />
                                        <input 
                                            type="date" 
                                            name="preferredDate"
                                            className="input input-bordered w-full custom-input" 
                                            defaultValue={new Date(Date.now() + 7*24*60*60*1000).toISOString().split('T')[0]}
                                            required 
                                        />
                                        <select name="preferredTime" className="select select-bordered w-full custom-input" defaultValue="Morning" required>
                                            <option value="">Preferred time</option>
                                            <option value="Morning">Morning (8AM-12PM)</option>
                                            <option value="Afternoon">Afternoon (12PM-5PM)</option>
                                            <option value="Evening">Evening (5PM-8PM)</option>
                                        </select>
                                        <button type="submit" className="custom-btn btn btn-sm w-full">Book Appointment</button>
                                    </div>
                                </form>
                            </div>
                        );
                        addMessage("I'll help you book a medical appointment. Let me get the details.", 'system', appointmentForm);
                    }, 1000);
                } else if (task === "Lab Results") {
                    setTimeout(() => {
                        const labForm = (
                            <div className="custom-card p-4 mt-2">
                                <h3 className="font-bold custom-accent mb-3">Lab Results Inquiry</h3>
                                <form onSubmit={(e) => {
                                    e.preventDefault();
                                    const labData = {
                                        testType: e.target.testType.value,
                                        testDate: e.target.testDate.value,
                                        patientInfo: e.target.patientInfo.value,
                                        urgency: e.target.urgency.value
                                    };
                                    handleLabResultsInquiry(labData);
                                }}>
                                    <div className="space-y-3">
                                        <select name="testType" className="select select-bordered w-full custom-input" defaultValue="Blood Test" required>
                                            <option value="">Type of test</option>
                                            <option value="Blood Test">Blood Test</option>
                                            <option value="Urine Test">Urine Test</option>
                                            <option value="X-Ray">X-Ray</option>
                                            <option value="MRI">MRI</option>
                                            <option value="CT Scan">CT Scan</option>
                                            <option value="Biopsy">Biopsy</option>
                                            <option value="Other">Other</option>
                                        </select>
                                        <input 
                                            type="date" 
                                            name="testDate"
                                            className="input input-bordered w-full custom-input" 
                                            defaultValue={new Date(Date.now() - 3*24*60*60*1000).toISOString().split('T')[0]}
                                            required 
                                        />
                                        <input 
                                            type="text" 
                                            name="patientInfo"
                                            placeholder="Patient name and DOB" 
                                            className="input input-bordered w-full custom-input" 
                                            defaultValue="John Smith, DOB: 01/15/1990"
                                            required 
                                        />
                                        <select name="urgency" className="select select-bordered w-full custom-input" defaultValue="Standard" required>
                                            <option value="">How urgent?</option>
                                            <option value="Standard">Standard inquiry</option>
                                            <option value="Urgent">Urgent - need results soon</option>
                                            <option value="Follow-up">Follow-up appointment needed</option>
                                        </select>
                                        <button type="submit" className="custom-btn btn btn-sm w-full">Check Lab Results</button>
                                    </div>
                                </form>
                            </div>
                        );
                        addMessage("I'll help you check your lab results. Let me get the details.", 'system', labForm);
                    }, 1000);
                }
            };

            // Handle medical appointment booking
            const handleMedicalAppointment = (appointmentData) => {
                addMessage(`Medical appointment: ${appointmentData.specialist} - ${appointmentData.urgency} in ${appointmentData.location}`, 'user');
                setTimeout(() => {
                    addMessageWithTyping(`I'm calling medical centers in ${appointmentData.location} to book your ${appointmentData.specialist.toLowerCase()} appointment...`);
                }, 1000);
                setTimeout(() => {
                    showMedicalAppointmentOptions(appointmentData);
                }, 3000);
            };

            // Handle lab results inquiry
            const handleLabResultsInquiry = (labData) => {
                addMessage(`Lab results inquiry: ${labData.testType} from ${labData.testDate}`, 'user');
                setTimeout(() => {
                    addMessageWithTyping(`I'm calling the lab to check your ${labData.testType.toLowerCase()} results...`);
                }, 1000);
                setTimeout(() => {
                    showLabResultsResponse(labData);
                }, 3000);
            };

            // Show medical appointment options with realistic calling simulation
            const showMedicalAppointmentOptions = (appointmentData) => {
                // Start calling simulation
                setIsProcessing(true);
                
                setTimeout(() => {
                    setProcessingStep('Calling 15 medical centers...');
                    addMessageWithTyping(`I'm calling 15 medical centers in ${appointmentData.location} to find the best options...`);
                }, 1000);

                setTimeout(() => {
                    setProcessingStep('Checking availability...');
                    addMessageWithTyping("Checking availability and insurance coverage...");
                }, 3000);

                setTimeout(() => {
                    setProcessingStep('Preparing results...');
                    setIsProcessing(false);
                    showMedicalCenterCards(appointmentData);
                }, 5000);
            };

            // Show medical center cards (extracted from original function)
            const showMedicalCenterCards = (appointmentData) => {
                const userLocation = userProfile.personalInfo.location || "New York, NY";
                const isUrgent = appointmentData.urgency === "Emergency" || appointmentData.urgency === "Urgent";
                const hasInsurance = userProfile.personalInfo.insurance || "Standard Insurance";
                
                // Get user's medical history
                const getMedicalHistory = () => {
                    const history = userProfile.preferences.serviceHistory;
                    const medicalHistory = history.filter(s => s.type.includes("Medical") || s.type.includes("Doctor"));
                    return {
                        hasHistory: medicalHistory.length > 0,
                        lastVisit: medicalHistory.length > 0 ? medicalHistory[medicalHistory.length - 1] : null,
                        preferredProvider: medicalHistory.length > 0 ? medicalHistory[0].provider : null
                    };
                };
                
                const medHistory = getMedicalHistory();
                
                const medicalCenters = [
                    {
                        name: "City Medical Center",
                        specialist: appointmentData.specialist,
                        rating: 4.7,
                        availability: isUrgent ? "Available today at 2:00 PM" : "Available tomorrow at 10:00 AM",
                        location: "Downtown",
                        price: isUrgent ? "$180" : "$120",
                        description: "Modern facility with experienced specialists",
                        insuranceAccepted: hasInsurance,
                        waitTime: isUrgent ? "Same day" : "1-2 days",
                        equipment: "State-of-the-art diagnostic equipment",
                        parking: "Free valet parking available",
                        languages: "English, Spanish, French",
                        userNote: medHistory.hasHistory ? `You've been here before - ${medHistory.lastVisit?.date}` : "New patient welcome package available",
                        specialFeatures: isUrgent ? "Emergency care available" : "Comprehensive wellness programs"
                    },
                    {
                        name: "Family Health Clinic",
                        specialist: appointmentData.specialist,
                        rating: 4.5,
                        availability: "Available day after tomorrow at 2:00 PM",
                        location: "Midtown",
                        price: "$95",
                        description: "Friendly staff, comprehensive care",
                        insuranceAccepted: hasInsurance,
                        waitTime: "2-3 days",
                        equipment: "Standard medical equipment",
                        parking: "Street parking available",
                        languages: "English, Spanish",
                        userNote: medHistory.hasHistory ? `You've been here before - ${medHistory.lastVisit?.date}` : "Family-friendly environment",
                        specialFeatures: "Pediatric care available"
                    },
                    {
                        name: "Premium Medical Group",
                        specialist: appointmentData.specialist,
                        rating: 4.9,
                        availability: "Available next week, flexible timing",
                        location: "Uptown",
                        price: "$180",
                        description: "Top-rated specialists, state-of-the-art equipment",
                        insuranceAccepted: hasInsurance,
                        waitTime: "1 week",
                        equipment: "Advanced diagnostic equipment",
                        parking: "Valet parking included",
                        languages: "English, Spanish, French, German",
                        userNote: medHistory.hasHistory ? `You've been here before - ${medHistory.lastVisit?.date}` : "VIP treatment available",
                        specialFeatures: "Concierge medical services"
                    }
                ];
                
                const medicalCards = (
                    <div className="space-y-3 mt-3">
                        {medicalCenters.map((center, index) => (
                            <div key={index} className="custom-card p-4 border border-gray-600 hover:border-blue-400 transition-all duration-300 cursor-pointer hover:shadow-lg" onClick={() => handleMedicalCenterSelect(center, appointmentData)}>
                                <div className="flex justify-between items-start mb-3">
                                    <div>
                                        <h3 className="font-bold custom-text text-lg">{center.name}</h3>
                                        <p className="text-sm custom-text-muted">{center.specialist} • {center.location}</p>
                                    </div>
                                    <div className="flex items-center gap-1">
                                        {[...Array(5)].map((_, i) => (
                                            <input key={i} type="radio" className="mask mask-star-2 bg-yellow-400" disabled checked={i < Math.floor(center.rating)} />
                                        ))}
                                        <span className="text-sm custom-text ml-1 font-semibold">{center.rating}</span>
                                    </div>
                                </div>
                                
                                <p className="text-sm custom-text-muted mb-3">{center.description}</p>
                                
                                <div className="grid grid-cols-2 gap-2 mb-3 text-xs">
                                    <div className="flex items-center gap-1">
                                        <span className="text-blue-400">🏥</span>
                                        <span className="custom-text-muted">{center.equipment}</span>
                                    </div>
                                    <div className="flex items-center gap-1">
                                        <span className="text-green-400">🚗</span>
                                        <span className="custom-text-muted">{center.parking}</span>
                                    </div>
                                    <div className="flex items-center gap-1">
                                        <span className="text-purple-400">💬</span>
                                        <span className="custom-text-muted">{center.languages}</span>
                                    </div>
                                    <div className="flex items-center gap-1">
                                        <span className="text-orange-400">⏱️</span>
                                        <span className="custom-text-muted">{center.waitTime}</span>
                                    </div>
                                </div>
                                
                                <div className="mb-3">
                                    <div className="flex items-center gap-1 mb-1">
                                        <span className="text-green-400">✅</span>
                                        <span className="text-xs custom-text-muted">Insurance: {center.insuranceAccepted}</span>
                                    </div>
                                    <div className="flex items-center gap-1">
                                        <span className="text-blue-400">⭐</span>
                                        <span className="text-xs custom-text-muted">{center.specialFeatures}</span>
                                    </div>
                                </div>
                                
                                <div className="flex justify-between items-center mb-2">
                                    <span className="font-bold custom-accent text-lg">{center.price}</span>
                                    {center.userNote && (
                                        <span className="text-xs custom-text-muted italic">💡 {center.userNote}</span>
                                    )}
                                </div>
                                
                                <div className="text-xs custom-text-muted">
                                    📅 {center.availability}
                                </div>
                            </div>
                        ))}
                    </div>
                );
                
                addMessage("I found some great medical centers for your appointment. Here are the best options:", 'system', medicalCards);
            };

            // Show lab results response
            const showLabResultsResponse = (labData) => {
                const resultsCard = (
                    <div className="custom-card border border-blue-500 slide-up mt-2">
                        <div className="card-body">
                            <div className="flex items-center gap-3">
                                <svg xmlns="http://www.w3.org/2000/svg" className="stroke-current shrink-0 h-6 w-6 text-blue-400" fill="none" viewBox="0 0 24 24">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                </svg>
                                <div>
                                    <h3 className="font-bold custom-text">Lab Results Available!</h3>
                                    <div className="text-xs custom-text-muted">
                                        {labData.testType} from {labData.testDate}<br/>
                                        Results: Normal range<br/>
                                        Doctor will review and contact you within 24 hours
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                );
                
                addMessage("Great news! Your lab results are ready. Here's what I found:", 'system', resultsCard);
                
                setTimeout(() => {
                    addMessageWithTyping("The lab confirmed your results are within normal range. Your doctor will review them and contact you within 24 hours if any follow-up is needed.");
                }, 2000);
            };

            // Handle medical center selection - NEW CLEAN VERSION
            const handleMedicalCenterSelect = (center, appointmentData) => {
                addMessage(`I choose: ${center.name}`, 'user');
                
                console.log('handleMedicalCenterSelect called with:', center, appointmentData); // Debug log
                console.log('hasPaymentInfo():', hasPaymentInfo()); // Debug log
                
                // Check if we need payment info before booking
                if (!hasPaymentInfo()) {
                    const bookingData = { type: 'medical', center, appointmentData };
                    console.log('Setting pendingBooking:', bookingData); // Debug log
                    setPendingBooking(bookingData);
                    pendingBookingRef.current = bookingData; // Also store in ref
                    setCurrentStep('payment-form');
                    showPaymentForm();
                    return;
                }
                
                // If payment info exists, proceed directly to booking
                console.log('Payment info exists, calling processMedicalBooking directly'); // Debug log
                processMedicalBooking(center, appointmentData);
            };

            // Process medical booking - NEW CLEAN VERSION
            const processMedicalBooking = (center, appointmentData) => {
                console.log('processMedicalBooking called with:', center, appointmentData); // Debug log
                
                setTimeout(() => {
                    addMessageWithTyping(`Perfect! I'm calling ${center.name} now to confirm your appointment...`);
                }, 1000);
                
                setTimeout(() => {
                    addMessageWithTyping("Connecting to the medical center...");
                }, 2000);
                
                setTimeout(() => {
                    addMessageWithTyping("Speaking with the receptionist...");
                }, 3000);
                
                setTimeout(() => {
                    console.log('About to call showMedicalConfirmation'); // Debug log
                    showMedicalConfirmation(center, appointmentData);
                }, 5000);
            };

            // Show medical confirmation - UPDATED VERSION
            const showMedicalConfirmation = (center, appointmentData) => {
                const confirmationCard = (
                    <div className="custom-card border border-green-500 slide-up mt-2">
                        <div className="card-body">
                            <div className="flex items-center gap-3">
                                <svg xmlns="http://www.w3.org/2000/svg" className="stroke-current shrink-0 h-6 w-6 text-green-400" fill="none" viewBox="0 0 24 24">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                                <div>
                                    <h3 className="font-bold custom-text">Appointment Confirmed!</h3>
                                    <div className="text-xs custom-text-muted">
                                        {center.name} • {appointmentData.specialist}<br/>
                                        {center.availability} • {center.price}<br/>
                                        Confirmation: #M{Math.random().toString(36).substr(2, 8).toUpperCase()}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                );
                
                addMessage(`Excellent! Your medical appointment is confirmed at ${center.name}. Here are the details:`, 'system', confirmationCard);
                
                // Update user profile with service history and minutes
                const newService = {
                    type: 'Medical Appointment',
                    provider: center.name,
                    specialist: appointmentData.specialist,
                    date: new Date().toLocaleDateString(),
                    status: 'Confirmed',
                    price: center.price
                };
                
                setUserProfile(prev => ({
                    ...prev,
                    preferences: {
                        ...prev.preferences,
                        serviceHistory: [...prev.preferences.serviceHistory, newService]
                    },
                    subscription: {
                        ...prev.subscription,
                        minutesUsed: prev.subscription.minutesUsed + 3,
                        minutesRemaining: prev.subscription.minutesRemaining - 3
                    }
                }));
                
                setTimeout(() => {
                    addMessageWithTyping("I've sent you a confirmation email and SMS reminder. Please arrive 15 minutes early and bring your insurance card and ID.");
                }, 2000);
            };

            // Handle doctor type selection
            const handleDoctorTypeSelect = (doctorType) => {
                addMessage(doctorType, 'user');
                setCurrentStep('contact-form');
                showContactForm("Doctor Appointment", doctorType);
            };

            // Check if user has complete profile data
            const hasCompleteProfile = () => {
                const { personalInfo, paymentInfo } = userProfile;
                return personalInfo.name && personalInfo.email && personalInfo.phone && 
                       personalInfo.location && paymentInfo.cardNumber && paymentInfo.expiryDate && 
                       paymentInfo.cvv && paymentInfo.cardName;
            };

            // Check if user has personal info only
            const hasPersonalInfo = () => {
                const { personalInfo } = userProfile;
                return personalInfo.name && personalInfo.email && personalInfo.phone && personalInfo.location;
            };

            // Check if user has payment info
            const hasPaymentInfo = () => {
                const { paymentInfo } = userProfile;
                return paymentInfo.cardNumber && paymentInfo.expiryDate && paymentInfo.cvv && paymentInfo.cardName;
            };

            // Show contact form or skip if data exists
            const showContactForm = (serviceType, doctorType = null) => {
                // Check if we already have complete user data
                if (hasCompleteProfile()) {
                    setTimeout(() => {
                        const existingDataCard = (
                            <div className="custom-card border border-green-500 slide-up mt-2">
                                <div className="card-body">
                                    <div className="flex items-center gap-3">
                                        <svg xmlns="http://www.w3.org/2000/svg" className="stroke-current shrink-0 h-6 w-6 text-green-400" fill="none" viewBox="0 0 24 24">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                                        </svg>
                                        <div>
                                            <h3 className="font-bold custom-text">Profile Complete!</h3>
                                            <div className="text-xs custom-text-muted">
                                                I have all your information: {userProfile.personalInfo.name}, {userProfile.personalInfo.email}<br/>
                                                Payment method: ****{userProfile.paymentInfo.cardNumber.slice(-4)}<br/>
                                                Ready to book {serviceType.toLowerCase()}!
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        );
                        addMessage("Perfect! I already have all your information from previous bookings.", 'system', existingDataCard);
                    }, 1000);
                    
                    setTimeout(() => {
                        addMessageWithTyping(`I'll use your existing profile to book ${serviceType.toLowerCase()}. Let me find the best options for you...`);
                    }, 3000);
                    
                    setTimeout(() => {
                        // Skip directly to service options based on service type
                        if (serviceType === "Restaurant Reservation") {
                            showRestaurantOptions({ cuisine: "Italian", guests: "2", date: new Date(Date.now() + 24*60*60*1000).toISOString().split('T')[0], time: "19:00", occasion: "Date", budget: "$30-50" });
                        } else if (serviceType === "Cleaning Service") {
                            showCleaningOptions({ serviceType: "Deep Clean", propertySize: "2-3 Bedrooms", urgency: "Within 3 days", budget: "$100-200" });
                        } else if (serviceType === "Beauty Salon") {
                            showBeautyOptions({ serviceType: "Haircut & Style", hairType: "Straight", occasion: "Regular Maintenance", budget: "$80-150" });
                        } else {
                            // For other services, show generic options
                            showGenericServiceOptions(serviceType);
                        }
                    }, 5000);
                    return;
                }

                // Check if we have personal info but no payment info
                if (hasPersonalInfo() && !hasPaymentInfo()) {
                    setCurrentStep('payment-form');
                    showPaymentForm();
                    return;
                }

                // If no personal info, show the contact form
                setTimeout(() => {
                    const contactForm = (
                        <div className="custom-card p-4 mt-2">
                            <h3 className="font-bold custom-accent mb-3">Contact Information</h3>
                            <form onSubmit={(e) => {
                                e.preventDefault();
                                const formData = {
                                    name: e.target.name.value,
                                    email: e.target.email.value,
                                    phone: e.target.phone.value,
                                    location: e.target.location.value,
                                    serviceType: serviceType,
                                    doctorType: doctorType
                                };
                                handleFormSubmit(formData);
                            }}>
                                <div className="space-y-3">
                                    <input 
                                        type="text" 
                                        name="name"
                                        placeholder="Full Name" 
                                        className="input input-bordered w-full custom-input" 
                                        defaultValue="John Smith"
                                        required 
                                    />
                                    <input 
                                        type="email" 
                                        name="email"
                                        placeholder="Email" 
                                        className="input input-bordered w-full custom-input" 
                                        defaultValue="john.smith@email.com"
                                        required 
                                    />
                                    <input 
                                        type="tel" 
                                        name="phone"
                                        placeholder="Phone Number" 
                                        className="input input-bordered w-full custom-input" 
                                        defaultValue="+1 (555) 123-4567"
                                        required 
                                    />
                                    <input 
                                        type="text" 
                                        name="location"
                                        placeholder="Location (City, State)" 
                                        className="input input-bordered w-full custom-input" 
                                        defaultValue="New York, NY"
                                        required 
                                    />
                                    <button type="submit" className="custom-btn btn btn-sm w-full">
                                        Continue
                                    </button>
                                </div>
                            </form>
                        </div>
                    );
                    addMessage(`I'll help you with ${serviceType.toLowerCase()}. Let me get your contact information first.`, 'system', contactForm);
                }, 1000);
            };

            // Show generic service options for services without specific forms
            const showGenericServiceOptions = (serviceType) => {
                const genericServices = [
                    {
                        name: `${serviceType} Provider 1`,
                        rating: 4.5,
                        availability: "Available tomorrow",
                        price: "$50-100",
                        description: "Professional service with good reviews"
                    },
                    {
                        name: `${serviceType} Provider 2`,
                        rating: 4.7,
                        availability: "Available today",
                        price: "$75-125",
                        description: "Top-rated service provider"
                    },
                    {
                        name: `${serviceType} Provider 3`,
                        rating: 4.3,
                        availability: "Available next week",
                        price: "$40-80",
                        description: "Affordable and reliable service"
                    }
                ];
                
                const serviceCards = (
                    <div className="space-y-3 mt-3">
                        {genericServices.map((service, index) => (
                            <div key={index} className="custom-card p-4 border border-gray-600 hover:border-purple-400 transition-colors cursor-pointer" onClick={() => handleGenericServiceSelect(service, serviceType)}>
                                <div className="flex justify-between items-start mb-2">
                                    <h3 className="font-bold custom-text">{service.name}</h3>
                                    <div className="flex items-center gap-1">
                                        {[...Array(5)].map((_, i) => (
                                            <input key={i} type="radio" className="mask mask-star-2 bg-yellow-400" disabled checked={i < Math.floor(service.rating)} />
                                        ))}
                                        <span className="text-sm custom-text ml-1">{service.rating}</span>
                                    </div>
                                </div>
                                <p className="text-sm custom-text-muted mb-2">{service.description}</p>
                                <div className="flex justify-between items-center">
                                    <span className="text-xs custom-text-muted">{service.availability}</span>
                                    <span className="font-bold custom-accent">{service.price}</span>
                                </div>
                            </div>
                        ))}
                    </div>
                );
                
                addMessage(`I found some great ${serviceType.toLowerCase()} options for you:`, 'system', null, serviceCards);
            };

            // Handle generic service selection
            const handleGenericServiceSelect = (service, serviceType) => {
                addMessage(`I choose: ${service.name}`, 'user');
                setTimeout(() => {
                    addMessageWithTyping(`Perfect! I'm calling ${service.name} now to book your ${serviceType.toLowerCase()}...`);
                }, 1000);
                setTimeout(() => {
                    showGenericServiceConfirmation(service, serviceType);
                }, 3000);
            };

            // Show generic service confirmation
            const showGenericServiceConfirmation = (service, serviceType) => {
                const confirmationCard = (
                    <div className="custom-card border border-green-500 slide-up mt-2">
                        <div className="card-body">
                            <div className="flex items-center gap-3">
                                <svg xmlns="http://www.w3.org/2000/svg" className="stroke-current shrink-0 h-6 w-6 text-green-400" fill="none" viewBox="0 0 24 24">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                                <div>
                                    <h3 className="font-bold custom-text">Service Confirmed!</h3>
                                    <div className="text-xs custom-text-muted">
                                        {service.name} • {serviceType}<br/>
                                        {service.availability} • {service.price}<br/>
                                        Confirmation: #{Math.random().toString(36).substr(2, 8).toUpperCase()}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                );
                
                addMessage(`Excellent! Your ${serviceType.toLowerCase()} is confirmed with ${service.name}. Here are the details:`, 'system', confirmationCard);
                
                // Add to service history
                const newService = {
                    type: serviceType,
                    provider: service.name,
                    date: new Date().toLocaleDateString(),
                    status: 'Confirmed',
                    price: service.price
                };
                
                setUserProfile(prev => ({
                    ...prev,
                    preferences: {
                        ...prev.preferences,
                        serviceHistory: [...prev.preferences.serviceHistory, newService]
                    },
                    subscription: {
                        ...prev.subscription,
                        minutesUsed: prev.subscription.minutesUsed + 5, // Simulate minutes used
                        minutesRemaining: prev.subscription.minutesRemaining - 5
                    }
                }));
                
                setTimeout(() => {
                    addMessageWithTyping("I've sent you a confirmation email and SMS reminder. The service provider will contact you with specific details.");
                }, 2000);
            };

            // Handle contact form submission
            const handleFormSubmit = (formData) => {
                // Save to user profile
                setUserProfile(prev => ({
                    ...prev,
                    personalInfo: {
                        ...prev.personalInfo,
                        name: formData.name,
                        email: formData.email,
                        phone: formData.phone,
                        location: formData.location
                    }
                }));
                
                setUserData(formData);
                addMessage(`Contact info: ${formData.name}, ${formData.email}, ${formData.phone}`, 'user');
                
                // If it's a doctor appointment, show medical form first
                if (formData.serviceType === "Doctor Appointment") {
                    setCurrentStep('medical-form');
                    setTimeout(() => {
                        const medicalForm = (
                            <div className="custom-card p-4 mt-2">
                                <h3 className="font-bold custom-accent mb-3">Medical Information</h3>
                                <form onSubmit={(e) => {
                                    e.preventDefault();
                                    const medicalData = {
                                        medicalHistory: e.target.medicalHistory.value,
                                        budget: e.target.budget.value,
                                        insurance: e.target.insurance.value,
                                        symptoms: e.target.symptoms.value,
                                        location: e.target.location.value
                                    };
                                    handleMedicalSubmit(medicalData);
                                }}>
                                    <div className="space-y-3">
                                        <textarea 
                                            name="medicalHistory"
                                            placeholder="Brief medical history (optional)" 
                                            className="textarea textarea-bordered w-full custom-input" 
                                            rows="3"
                                            defaultValue="No significant medical history"
                                        />
                                        <select 
                                            name="budget"
                                            className="select select-bordered w-full custom-input" 
                                            defaultValue="$100-200"
                                            required
                                        >
                                            <option value="">Select your budget range</option>
                                            <option value="$50-100">$50-100</option>
                                            <option value="$100-200">$100-200</option>
                                            <option value="$200-300">$200-300</option>
                                            <option value="$300-500">$300-500</option>
                                            <option value="$500+">$500+</option>
                                        </select>
                                        <select 
                                            name="insurance"
                                            className="select select-bordered w-full custom-input" 
                                            defaultValue="Standard Insurance"
                                            required
                                        >
                                            <option value="">Select your insurance</option>
                                            <option value="Standard Insurance">Standard Insurance</option>
                                            <option value="Premium Insurance">Premium Insurance</option>
                                            <option value="Basic Insurance">Basic Insurance</option>
                                            <option value="Family Plan">Family Plan</option>
                                            <option value="Student Insurance">Student Insurance</option>
                                            <option value="Government Insurance">Government Insurance</option>
                                            <option value="Senior Insurance">Senior Insurance</option>
                                            <option value="No Insurance">No Insurance</option>
                                        </select>
                                        <input 
                                            type="text" 
                                            name="symptoms"
                                            placeholder="Current symptoms or reason for visit" 
                                            className="input input-bordered w-full custom-input" 
                                            defaultValue="Annual checkup"
                                            required 
                                        />
                                        <input 
                                            type="text" 
                                            name="location"
                                            placeholder="Your location (e.g., Manhattan, Brooklyn, Queens)" 
                                            className="input input-bordered w-full custom-input" 
                                            defaultValue={userProfile.personalInfo.location || "New York, NY"}
                                            required 
                                        />
                                        <button type="submit" className="custom-btn btn btn-sm w-full">
                                            Continue to Payment
                                        </button>
                                    </div>
                                </form>
                            </div>
                        );
                        addMessage("Now I need some medical information to find the best options within your budget and insurance coverage.", 'system', medicalForm);
                    }, 1000);
                } else {
                    // Check if we need payment info after contact form
                    if (!hasPaymentInfo()) {
                    setCurrentStep('payment-form');
                    showPaymentForm();
                    } else {
                        // If we have both personal and payment info, proceed to service
                        setTimeout(() => {
                            addMessageWithTyping("Perfect! I have all your information. Let me find the best options for you...");
                        }, 1000);
                        
                        setTimeout(() => {
                            // Route to appropriate service based on serviceType
                            const serviceType = formData.serviceType;
                            if (serviceType === "Restaurant Reservation") {
                                showRestaurantOptions({ cuisine: "Italian", guests: "2", date: new Date(Date.now() + 24*60*60*1000).toISOString().split('T')[0], time: "19:00", occasion: "Date", budget: "$30-50", location: formData.location });
                            } else if (serviceType === "Cleaning Service") {
                                showCleaningOptions({ serviceType: "Deep Clean", propertySize: "2-3 Bedrooms", urgency: "Within 3 days", budget: "$100-200", location: formData.location });
                            } else if (serviceType === "Beauty Salon") {
                                showBeautyOptions({ serviceType: "Haircut & Style", hairType: "Straight", occasion: "Regular Maintenance", budget: "$80-150", location: formData.location });
                            } else {
                                showGenericServiceOptions(serviceType);
                            }
                        }, 3000);
                    }
                }
            };

            // Handle medical form submission
            const handleMedicalSubmit = (medicalData) => {
                const fullData = { ...userData, ...medicalData };
                setUserData(fullData);
                addMessage(`Medical info: ${medicalData.budget} budget, ${medicalData.insurance} insurance`, 'user');
                setCurrentStep('payment-form');
                showPaymentForm();
            };

            // Handle restaurant preferences submission
            const handleRestaurantSubmit = (restaurantData) => {
                setUserData(prev => ({ ...prev, ...restaurantData, serviceType: "Restaurant Reservation" }));
                addMessage(`Restaurant preferences: ${restaurantData.cuisine} cuisine, ${restaurantData.guests} guests, ${restaurantData.date} at ${restaurantData.time}`, 'user');
                
                // Check if we need payment info
                if (!hasPaymentInfo()) {
                    setCurrentStep('payment-form');
                    showPaymentForm();
                    return;
                }
                
                // Start the deep restaurant booking flow
                setTimeout(() => {
                    addMessageWithTyping("Perfect! I'm calling restaurants in your area to find the best options for your ${restaurantData.occasion.toLowerCase()}.");
                }, 1000);
                
                setTimeout(() => {
                    addMessageWithTyping("Let me check availability and get you some great options...");
                }, 3000);
                
                setTimeout(() => {
                    showRestaurantOptions(restaurantData);
                }, 5000);
            };

            // Show restaurant options with realistic data
            const showRestaurantOptions = (restaurantData) => {
                const restaurants = getRestaurantOptions(restaurantData);
                
                const restaurantCards = (
                    <div className="space-y-3 mt-3">
                        {restaurants.map((restaurant, index) => (
                            <div key={index} className="custom-card p-4 border border-gray-600 hover:border-purple-400 transition-all duration-300 cursor-pointer hover:shadow-lg" onClick={() => handleRestaurantSelect(restaurant, restaurantData)}>
                                <div className="flex justify-between items-start mb-3">
                                    <div>
                                        <h3 className="font-bold custom-text text-lg">{restaurant.name}</h3>
                                        <p className="text-sm custom-text-muted">{restaurant.cuisine} • {restaurant.priceRange} • {restaurant.distance}</p>
                                    </div>
                                    <div className="flex items-center gap-1">
                                        {[...Array(5)].map((_, i) => (
                                            <input key={i} type="radio" className="mask mask-star-2 bg-yellow-400" disabled checked={i < Math.floor(restaurant.rating)} />
                                        ))}
                                        <span className="text-sm custom-text ml-1 font-semibold">{restaurant.rating}</span>
                                    </div>
                                </div>
                                
                                <p className="text-sm custom-text-muted mb-3">{restaurant.description}</p>
                                
                                <div className="grid grid-cols-2 gap-2 mb-3 text-xs">
                                    <div className="flex items-center gap-1">
                                        <span className="text-purple-400">📍</span>
                                        <span className="custom-text-muted">{restaurant.ambiance}</span>
                                    </div>
                                    <div className="flex items-center gap-1">
                                        <span className="text-orange-400">🍽️</span>
                                        <span className="custom-text-muted">{restaurant.signatureDish}</span>
                                    </div>
                                    <div className="flex items-center gap-1">
                                        <span className="text-blue-400">⏰</span>
                                        <span className="custom-text-muted">{restaurant.waitTime}</span>
                                    </div>
                                    <div className="flex items-center gap-1">
                                        <span className="text-green-400">✅</span>
                                        <span className="custom-text-muted">{restaurant.availability}</span>
                                    </div>
                                </div>
                                
                                <div className="flex justify-between items-center mb-2">
                                    <span className="font-bold custom-accent text-lg">{restaurant.price}</span>
                                    {restaurant.userNote && (
                                        <span className="text-xs custom-text-muted italic">💡 {restaurant.userNote}</span>
                                    )}
                                </div>
                                
                                {restaurant.specialOffers && (
                                    <div className="mt-2 p-2 bg-green-900/20 rounded border-l-2 border-green-500">
                                        <p className="text-xs custom-text">🎉 {restaurant.specialOffers}</p>
                                    </div>
                                )}
                            </div>
                        ))}
                    </div>
                );
                
                addMessage("I found some great options for you! Here are the restaurants that have availability:", 'system', null, restaurantCards);
            };

            // Get realistic restaurant options based on preferences
            const getRestaurantOptions = (preferences) => {
                const { cuisine, guests, date, time, occasion, budget, location } = preferences;
                const userLocation = location || userProfile.personalInfo.location || "New York, NY";
                const isWeekend = new Date(date).getDay() === 0 || new Date(date).getDay() === 6;
                const isPeakTime = time >= "19:00" && time <= "21:00";
                const isSpecialOccasion = occasion === "Date" || occasion === "Celebration";
                
                // Dynamic pricing based on demand
                const getDynamicPrice = (basePrice, isPeak, isWeekend, isSpecial) => {
                    let multiplier = 1;
                    if (isPeak) multiplier += 0.2;
                    if (isWeekend) multiplier += 0.15;
                    if (isSpecial) multiplier += 0.1;
                    return Math.round(basePrice * multiplier);
                };
                
                // Personalized recommendations based on user profile
                const getUserPreferences = () => {
                    const history = userProfile.preferences.serviceHistory;
                    const restaurantHistory = history.filter(s => s.type === "Restaurant Reservation");
                    if (restaurantHistory.length > 0) {
                        return {
                            hasHistory: true,
                            lastRestaurant: restaurantHistory[restaurantHistory.length - 1].provider,
                            preferredPriceRange: restaurantHistory.some(s => s.price.includes("$80+")) ? "high" : "medium"
                        };
                    }
                    return { hasHistory: false };
                };
                
                const userPrefs = getUserPreferences();
                
                if (cuisine === "Italian") {
                    const restaurants = [
                        {
                            name: "Bella Vista Ristorante",
                            cuisine: "Italian",
                            rating: 4.8,
                            priceRange: "$$$",
                            description: "Authentic Italian cuisine with fresh pasta and imported wines. Perfect for romantic dates.",
                            distance: "0.8 miles",
                            availability: isPeakTime ? "Available at 7:30 PM (30 min later)" : "Available at your preferred time",
                            price: `$${getDynamicPrice(55, isPeakTime, isWeekend, isSpecialOccasion)}-${getDynamicPrice(75, isPeakTime, isWeekend, isSpecialOccasion)} per person`,
                            specialOffers: isSpecialOccasion ? "Free dessert for special occasions" : "Wine pairing menu available",
                            waitTime: isPeakTime ? "15-20 min wait" : "Immediate seating",
                            ambiance: "Romantic, intimate lighting",
                            signatureDish: "Truffle Risotto",
                            userNote: userPrefs.hasHistory ? `Similar to your last visit to ${userPrefs.lastRestaurant}` : "Perfect for first-time visitors"
                        },
                        {
                            name: "Mama Rosa's Kitchen",
                            cuisine: "Italian",
                            rating: 4.5,
                            priceRange: "$$",
                            description: "Family-owned trattoria with homemade pasta and cozy atmosphere.",
                            distance: "1.2 miles",
                            availability: "Available at 7:30 PM (30 min later)",
                            price: "$25-40 per person",
                            specialOffers: null
                        },
                        {
                            name: "Il Forno Moderno",
                            cuisine: "Italian",
                            rating: 4.9,
                            priceRange: "$$$$",
                            description: "Modern Italian with innovative dishes and extensive wine selection.",
                            distance: "2.1 miles",
                            availability: "Available at your preferred time",
                            price: "$80-120 per person",
                            specialOffers: "Wine pairing menu available"
                        }
                    ];
                } else if (cuisine === "Asian") {
                    return [
                        {
                            name: "Golden Dragon Palace",
                            cuisine: "Chinese",
                            rating: 4.6,
                            priceRange: "$$",
                            description: "Traditional Chinese cuisine with dim sum and Peking duck.",
                            distance: "1.5 miles",
                            availability: "Available at your preferred time",
                            price: "$30-50 per person",
                            specialOffers: null
                        },
                        {
                            name: "Sakura Sushi Bar",
                            cuisine: "Japanese",
                            rating: 4.7,
                            priceRange: "$$$",
                            description: "Fresh sushi and sashimi with authentic Japanese atmosphere.",
                            distance: "0.9 miles",
                            availability: "Available at 8:00 PM (1 hour later)",
                            price: "$50-80 per person",
                            specialOffers: "Omakase menu available"
                        }
                    ];
                }
                
                // Default options
                return [
                    {
                        name: "The Garden Bistro",
                        cuisine: "Mediterranean",
                        rating: 4.4,
                        priceRange: "$$",
                        description: "Fresh Mediterranean dishes with outdoor seating.",
                        distance: "1.8 miles",
                        availability: "Available at your preferred time",
                        price: "$35-55 per person",
                        specialOffers: null
                    }
                ];
            };

            // Handle restaurant selection
            const handleRestaurantSelect = (restaurant, preferences) => {
                addMessage(`I choose: ${restaurant.name}`, 'user');
                
                // Check if we need payment info before booking
                if (!hasPaymentInfo()) {
                    setPendingBooking({ type: 'restaurant', restaurant, preferences });
                    setCurrentStep('payment-form');
                    showPaymentForm();
                    return;
                }
                
                setTimeout(() => {
                    addMessageWithTyping(`Excellent choice! I'm calling ${restaurant.name} now to make your reservation...`);
                }, 1000);
                
                setTimeout(() => {
                    showRestaurantCallSimulation(restaurant, preferences);
                }, 3000);
            };

            // Show restaurant call simulation
            const showRestaurantCallSimulation = (restaurant, preferences) => {
                const callSteps = [
                    "Calling restaurant...",
                    "Speaking with host...",
                    "Checking availability...",
                    "Confirming details...",
                    "Processing reservation..."
                ];
                
                let currentStep = 0;
                const stepInterval = setInterval(() => {
                    if (currentStep < callSteps.length) {
                        addMessageWithTyping(callSteps[currentStep], 800);
                        currentStep++;
                    } else {
                        clearInterval(stepInterval);
                        setTimeout(() => {
                            showRestaurantConfirmation(restaurant, preferences);
                        }, 2000);
                    }
                }, 2000);
            };

            // Show restaurant confirmation
            const showRestaurantConfirmation = (restaurant, preferences) => {
                const confirmationCard = (
                    <div className="custom-card border border-green-500 slide-up mt-2">
                        <div className="card-body">
                            <div className="flex items-center gap-3">
                                <svg xmlns="http://www.w3.org/2000/svg" className="stroke-current shrink-0 h-6 w-6 text-green-400" fill="none" viewBox="0 0 24 24">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                                <div>
                                    <h3 className="font-bold custom-text">Reservation Confirmed!</h3>
                                    <div className="text-xs custom-text-muted">
                                        {restaurant.name} • {preferences.date} at {preferences.time}<br/>
                                        Party of {preferences.guests} • {preferences.occasion}<br/>
                                        Confirmation: #R{Math.random().toString(36).substr(2, 8).toUpperCase()}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                );
                
                addMessage(`Perfect! Your reservation is confirmed at ${restaurant.name}. Here are the details:`, 'system', confirmationCard);
                
                // Update user profile with service history and minutes
                const newService = {
                    type: 'Restaurant Reservation',
                    provider: restaurant.name,
                    date: preferences.date,
                    time: preferences.time,
                    guests: preferences.guests,
                    occasion: preferences.occasion,
                    status: 'Confirmed',
                    price: restaurant.price
                };
                
                setUserProfile(prev => ({
                    ...prev,
                    preferences: {
                        ...prev.preferences,
                        serviceHistory: [...prev.preferences.serviceHistory, newService]
                    },
                    subscription: {
                        ...prev.subscription,
                        minutesUsed: prev.subscription.minutesUsed + 4,
                        minutesRemaining: prev.subscription.minutesRemaining - 4
                    }
                }));
                
                setTimeout(() => {
                    addMessageWithTyping("I've sent you a confirmation email and SMS reminder. The restaurant will call you 2 hours before your reservation to confirm.");
                }, 2000);
                
                setTimeout(() => {
                    const continueButtons = (
                        <div className="space-y-3 mt-3">
                            <button 
                                className="custom-btn btn w-full"
                                onClick={() => handleScenarioSelect("booking")}
                            >
                                Book another service
                            </button>
                            <button 
                                className="custom-btn btn w-full"
                                onClick={() => handleScenarioSelect("calling")}
                            >
                                Make another call
                            </button>
                        </div>
                    );
                    addMessage("Is there anything else I can help you with today?", 'system', null, continueButtons);
                }, 4000);
            };

            // Handle cleaning service submission
            const handleCleaningSubmit = (cleaningData) => {
                setUserData(prev => ({ ...prev, ...cleaningData, serviceType: "Cleaning Service" }));
                addMessage(`Cleaning needs: ${cleaningData.serviceType} for ${cleaningData.propertySize}, ${cleaningData.urgency}`, 'user');
                
                // Check if we need payment info
                if (!hasPaymentInfo()) {
                    setCurrentStep('payment-form');
                    showPaymentForm();
                    return;
                }
                
                setTimeout(() => {
                    addMessageWithTyping("Perfect! I'm calling cleaning services in your area to get you the best quotes and availability.");
                }, 1000);
                
                setTimeout(() => {
                    addMessageWithTyping("Let me check with multiple providers to find the best match for your needs...");
                }, 3000);
                
                setTimeout(() => {
                    showCleaningOptions(cleaningData);
                }, 5000);
            };

            // Handle beauty service submission
            const handleBeautySubmit = (beautyData) => {
                setUserData(prev => ({ ...prev, ...beautyData, serviceType: "Beauty Salon" }));
                addMessage(`Beauty service: ${beautyData.serviceType} for ${beautyData.occasion}, ${beautyData.urgency}`, 'user');
                
                // Check if we need payment info
                if (!hasPaymentInfo()) {
                    setCurrentStep('payment-form');
                    showPaymentForm();
                    return;
                }
                
                setTimeout(() => {
                    addMessageWithTyping("Great! I'm calling salons and beauty services to find the perfect stylist for your needs.");
                }, 1000);
                
                setTimeout(() => {
                    addMessageWithTyping("Let me check availability and find someone experienced with your hair type...");
                }, 3000);
                
                setTimeout(() => {
                    showBeautyOptions(beautyData);
                }, 5000);
            };

            // Handle taxi service submission
            const handleTaxiSubmit = (taxiData) => {
                setUserData(prev => ({ ...prev, ...taxiData, serviceType: "Taxi/Ride" }));
                addMessage(`Ride request: ${taxiData.rideType} from ${taxiData.pickupLocation} to ${taxiData.destination}, ${taxiData.urgency}`, 'user');
                
                setTimeout(() => {
                    addMessageWithTyping("Perfect! I'm calling ride services to find you the best option for your trip.");
                }, 1000);
                
                setTimeout(() => {
                    addMessageWithTyping("Let me check availability and get you the best rates...");
                }, 3000);
                
                setTimeout(() => {
                    showTaxiOptions(taxiData);
                }, 5000);
            };

            // Show cleaning service options
            const showCleaningOptions = (cleaningData) => {
                const cleaningServices = getCleaningOptions(cleaningData);
                
                const cleaningCards = (
                    <div className="space-y-3 mt-3">
                        {cleaningServices.map((service, index) => (
                            <div key={index} className="custom-card p-4 border border-gray-600 hover:border-purple-400 transition-colors cursor-pointer" onClick={() => handleCleaningSelect(service, cleaningData)}>
                                <div className="flex justify-between items-start mb-2">
                                    <h3 className="font-bold custom-text">{service.name}</h3>
                                    <div className="flex items-center gap-1">
                                        {[...Array(5)].map((_, i) => (
                                            <input key={i} type="radio" className="mask mask-star-2 bg-yellow-400" disabled checked={i < Math.floor(service.rating)} />
                                        ))}
                                        <span className="text-sm custom-text ml-1">{service.rating}</span>
                                    </div>
                                </div>
                                <p className="text-sm custom-text-muted mb-2">{service.specialty} • {service.availability}</p>
                                <p className="text-sm custom-text-muted mb-2">{service.description}</p>
                                <div className="flex justify-between items-center mb-2">
                                    <span className="text-xs custom-text-muted">{service.teamSize} • {service.insured}</span>
                                    <span className="font-bold custom-accent">{service.price}</span>
                                </div>
                                <div className="flex justify-between items-center">
                                    <span className="text-xs custom-text-muted">📍 {service.distance}</span>
                                    {service.specialOffers && (
                                        <span className="text-xs custom-accent">🎉 {service.specialOffers}</span>
                                    )}
                                </div>
                                {service.specialOffers && (
                                    <div className="mt-2 p-2 bg-green-900/20 rounded border-l-2 border-green-500">
                                        <p className="text-xs custom-text">🎉 {service.specialOffers}</p>
                                    </div>
                                )}
                            </div>
                        ))}
                    </div>
                );
                
                addMessage("I found some excellent cleaning services for you! Here are the best options:", 'system', null, cleaningCards);
            };

            // Show beauty service options
            const showBeautyOptions = (beautyData) => {
                const beautyServices = getBeautyOptions(beautyData);
                
                const beautyCards = (
                    <div className="space-y-3 mt-3">
                        {beautyServices.map((service, index) => (
                            <div key={index} className="custom-card p-4 border border-gray-600 hover:border-purple-400 transition-colors cursor-pointer" onClick={() => handleBeautySelect(service, beautyData)}>
                                <div className="flex justify-between items-start mb-2">
                                    <h3 className="font-bold custom-text">{service.name}</h3>
                                    <div className="flex items-center gap-1">
                                        {[...Array(5)].map((_, i) => (
                                            <input key={i} type="radio" className="mask mask-star-2 bg-yellow-400" disabled checked={i < Math.floor(service.rating)} />
                                        ))}
                                        <span className="text-sm custom-text ml-1">{service.rating}</span>
                                    </div>
                                </div>
                                <p className="text-sm custom-text-muted mb-2">{service.specialty} • {service.availability}</p>
                                <p className="text-sm custom-text-muted mb-2">{service.description}</p>
                                <div className="flex justify-between items-center">
                                    <span className="text-xs custom-text-muted">{service.experience} • {service.location}</span>
                                    <span className="font-bold custom-accent">{service.price}</span>
                                </div>
                                {service.specialOffers && (
                                    <div className="mt-2 p-2 bg-green-900/20 rounded border-l-2 border-green-500">
                                        <p className="text-xs custom-text">🎉 {service.specialOffers}</p>
                                    </div>
                                )}
                            </div>
                        ))}
                    </div>
                );
                
                addMessage("I found some amazing beauty services for you! Here are the best options:", 'system', null, beautyCards);
            };

            // Show taxi service options
            const showTaxiOptions = (taxiData) => {
                const taxiServices = getTaxiOptions(taxiData);
                
                const taxiCards = (
                    <div className="space-y-3 mt-3">
                        {taxiServices.map((service, index) => (
                            <div key={index} className="custom-card p-4 border border-gray-600 hover:border-purple-400 transition-colors cursor-pointer" onClick={() => handleTaxiSelect(service, taxiData)}>
                                <div className="flex justify-between items-start mb-2">
                                    <h3 className="font-bold custom-text">{service.name}</h3>
                                    <div className="flex items-center gap-1">
                                        {[...Array(5)].map((_, i) => (
                                            <input key={i} type="radio" className="mask mask-star-2 bg-yellow-400" disabled checked={i < Math.floor(service.rating)} />
                                        ))}
                                        <span className="text-sm custom-text ml-1">{service.rating}</span>
                                    </div>
                                </div>
                                <p className="text-sm custom-text-muted mb-2">{service.vehicleType} • {service.eta}</p>
                                <p className="text-sm custom-text-muted mb-2">{service.description}</p>
                                <div className="flex justify-between items-center">
                                    <span className="text-xs custom-text-muted">{service.driver} • {service.license}</span>
                                    <span className="font-bold custom-accent">{service.price}</span>
                                </div>
                                {service.specialOffers && (
                                    <div className="mt-2 p-2 bg-green-900/20 rounded border-l-2 border-green-500">
                                        <p className="text-xs custom-text">🎉 {service.specialOffers}</p>
                                    </div>
                                )}
                            </div>
                        ))}
                    </div>
                );
                
                addMessage("I found some great ride options for you! Here are the best choices:", 'system', null, taxiCards);
            };

            // Get cleaning service options
            const getCleaningOptions = (preferences) => {
                const { serviceType, propertySize, urgency, budget, location } = preferences;
                const userLocation = location || userProfile.personalInfo.location || "New York, NY";
                
                return [
                    {
                        name: "Sparkle Clean Pro",
                        specialty: "Deep Cleaning Specialists",
                        rating: 4.8,
                        availability: urgency === "Today" ? "Available today" : "Available within 24 hours",
                        description: "Professional deep cleaning with eco-friendly products. Fully insured and bonded team.",
                        teamSize: "2-3 cleaners",
                        insured: "Fully insured",
                        price: budget === "$50-100" ? "$85" : budget === "$100-200" ? "$145" : "$195",
                        specialOffers: "First-time customer: 20% off",
                        location: userLocation,
                        distance: "0.8 miles away"
                    },
                    {
                        name: "Quick Clean Express",
                        specialty: "Same-Day Service",
                        rating: 4.5,
                        availability: "Available today",
                        description: "Fast, reliable cleaning service perfect for busy schedules. Same-day availability guaranteed.",
                        teamSize: "1-2 cleaners",
                        insured: "Bonded & insured",
                        price: budget === "$50-100" ? "$75" : budget === "$100-200" ? "$125" : "$175",
                        specialOffers: null,
                        location: userLocation,
                        distance: "1.2 miles away"
                    },
                    {
                        name: "EcoClean Solutions",
                        specialty: "Eco-Friendly Cleaning",
                        rating: 4.7,
                        availability: urgency === "Today" ? "Available tomorrow" : "Available within 2 days",
                        description: "100% natural, pet-safe cleaning products. Perfect for families with allergies or pets.",
                        teamSize: "2 cleaners",
                        insured: "Fully insured",
                        price: budget === "$50-100" ? "$95" : budget === "$100-200" ? "$155" : "$205",
                        specialOffers: "Pet-safe guarantee",
                        location: userLocation,
                        distance: "2.1 miles away"
                    }
                ];
            };

            // Get beauty service options
            const getBeautyOptions = (preferences) => {
                const { serviceType, hairType, occasion, budget } = preferences;
                
                return [
                    {
                        name: "Glamour Studio",
                        specialty: "Hair & Makeup Specialists",
                        rating: 4.9,
                        availability: "Available this week",
                        description: "High-end salon specializing in special events and bridal services. Expert stylists with 10+ years experience.",
                        experience: "10+ years",
                        location: "Downtown",
                        price: budget === "$60-100" ? "$85" : budget === "$100-150" ? "$125" : "$185",
                        specialOffers: "Free consultation included"
                    },
                    {
                        name: "Curly Hair Experts",
                        specialty: "Curly & Textured Hair",
                        rating: 4.8,
                        availability: "Available tomorrow",
                        description: "Specialists in curly, wavy, and textured hair. DevaCurl certified stylists.",
                        experience: "8+ years",
                        location: "Midtown",
                        price: budget === "$60-100" ? "$75" : budget === "$100-150" ? "$115" : "$165",
                        specialOffers: "Free curl analysis"
                    },
                    {
                        name: "Quick Cuts & Style",
                        specialty: "Fast & Affordable",
                        rating: 4.4,
                        availability: "Available today",
                        description: "Quick, quality cuts and styling. Perfect for regular maintenance and busy schedules.",
                        experience: "5+ years",
                        location: "Multiple locations",
                        price: budget === "$60-100" ? "$45" : budget === "$100-150" ? "$65" : "$95",
                        specialOffers: "Walk-ins welcome"
                    }
                ];
            };

            // Get taxi service options
            const getTaxiOptions = (preferences) => {
                const { rideType, urgency, passengers, luggage } = preferences;
                
                return [
                    {
                        name: "Premium Ride Service",
                        vehicleType: "Luxury Sedan",
                        rating: 4.9,
                        eta: urgency === "ASAP" ? "3-5 minutes" : "15-20 minutes",
                        description: "Professional chauffeur service with luxury vehicles. Perfect for business or special occasions.",
                        driver: "Professional chauffeur",
                        license: "Commercial license",
                        price: rideType === "Premium" ? "$45-65" : "$35-50",
                        specialOffers: "Free water & WiFi"
                    },
                    {
                        name: "Reliable Taxi Co.",
                        vehicleType: "Standard Sedan",
                        rating: 4.6,
                        eta: urgency === "ASAP" ? "2-4 minutes" : "10-15 minutes",
                        description: "Reliable, affordable taxi service. Clean vehicles and experienced drivers.",
                        driver: "Experienced driver",
                        license: "Taxi license",
                        price: rideType === "Standard" ? "$25-35" : "$20-30",
                        specialOffers: null
                    },
                    {
                        name: "Family Transport",
                        vehicleType: "SUV/Minivan",
                        rating: 4.7,
                        eta: urgency === "ASAP" ? "5-8 minutes" : "20-25 minutes",
                        description: "Family-friendly service with child seats and extra space for luggage.",
                        driver: "Family-friendly driver",
                        license: "Commercial license",
                        price: passengers === "5+" ? "$40-55" : "$30-45",
                        specialOffers: "Child seats available"
                    }
                ];
            };

            // Handle service selections
            const handleCleaningSelect = (service, preferences) => {
                addMessage(`I choose: ${service.name}`, 'user');
                
                // Check if we need payment info before booking
                if (!hasPaymentInfo()) {
                    setPendingBooking({ type: 'cleaning', service, preferences });
                    setCurrentStep('payment-form');
                    showPaymentForm();
                    return;
                }
                
                setTimeout(() => {
                    addMessageWithTyping(`Great choice! I'm calling ${service.name} now to confirm your cleaning appointment...`);
                }, 1000);
                setTimeout(() => {
                    showServiceConfirmation(service, preferences, "Cleaning Service");
                }, 3000);
            };

            const handleBeautySelect = (service, preferences) => {
                addMessage(`I choose: ${service.name}`, 'user');
                
                // Check if we need payment info before booking
                if (!hasPaymentInfo()) {
                    setPendingBooking({ type: 'beauty', service, preferences });
                    setCurrentStep('payment-form');
                    showPaymentForm();
                    return;
                }
                
                setTimeout(() => {
                    addMessageWithTyping(`Perfect! I'm calling ${service.name} now to book your appointment...`);
                }, 1000);
                setTimeout(() => {
                    showServiceConfirmation(service, preferences, "Beauty Salon");
                }, 3000);
            };

            const handleTaxiSelect = (service, preferences) => {
                addMessage(`I choose: ${service.name}`, 'user');
                setTimeout(() => {
                    addMessageWithTyping(`Excellent! I'm calling ${service.name} now to arrange your ride...`);
                }, 1000);
                setTimeout(() => {
                    showServiceConfirmation(service, preferences, "Taxi/Ride");
                }, 3000);
            };

            // Generic service confirmation
            const showServiceConfirmation = (service, preferences, serviceType) => {
                const confirmationCard = (
                    <div className="custom-card border border-green-500 slide-up mt-2">
                        <div className="card-body">
                            <div className="flex items-center gap-3">
                                <svg xmlns="http://www.w3.org/2000/svg" className="stroke-current shrink-0 h-6 w-6 text-green-400" fill="none" viewBox="0 0 24 24">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                                <div>
                                    <h3 className="font-bold custom-text">Service Confirmed!</h3>
                                    <div className="text-xs custom-text-muted">
                                        {service.name} • {service.price}<br/>
                                        Confirmation: #{Math.random().toString(36).substr(2, 8).toUpperCase()}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                );
                
                addMessage(`Perfect! Your ${serviceType.toLowerCase()} is confirmed with ${service.name}. Here are the details:`, 'system', confirmationCard);
                
                // Update user profile with service history and minutes
                const newService = {
                    type: serviceType,
                    provider: service.name,
                    date: new Date().toLocaleDateString(),
                    status: 'Confirmed',
                    price: service.price
                };
                
                setUserProfile(prev => ({
                    ...prev,
                    preferences: {
                        ...prev.preferences,
                        serviceHistory: [...prev.preferences.serviceHistory, newService]
                    },
                    subscription: {
                        ...prev.subscription,
                        minutesUsed: prev.subscription.minutesUsed + 3,
                        minutesRemaining: prev.subscription.minutesRemaining - 3
                    }
                }));
                
                setTimeout(() => {
                    addMessageWithTyping("I've sent you a confirmation email and SMS reminder. The service provider will contact you with specific details.");
                }, 2000);
                
                setTimeout(() => {
                    const continueButtons = (
                        <div className="space-y-3 mt-3">
                            <button 
                                className="custom-btn btn w-full"
                                onClick={() => handleScenarioSelect("booking")}
                            >
                                Book another service
                            </button>
                            <button 
                                className="custom-btn btn w-full"
                                onClick={() => handleScenarioSelect("calling")}
                            >
                                Make another call
                            </button>
                        </div>
                    );
                    addMessage("Is there anything else I can help you with today?", 'system', null, continueButtons);
                }, 4000);
            };

            // Handle call type selection
            const handleCallTypeSelect = (callType) => {
                addMessage(callType, 'user');
                
                if (callType === "Customer Support") {
                    setTimeout(() => {
                        const supportForm = (
                            <div className="custom-card p-4 mt-2">
                                <h3 className="font-bold custom-accent mb-3">Customer Support Call Details</h3>
                                <form onSubmit={(e) => {
                                    e.preventDefault();
                                    const supportData = {
                                        company: e.target.company.value,
                                        issue: e.target.issue.value,
                                        accountInfo: e.target.accountInfo.value,
                                        urgency: e.target.urgency.value,
                                        desiredOutcome: e.target.desiredOutcome.value
                                    };
                                    handleSupportCall(supportData);
                                }}>
                                    <div className="space-y-3">
                                        <input 
                                            type="text" 
                                            name="company"
                                            placeholder="Company name (e.g., Netflix, Amazon, Verizon)" 
                                            className="input input-bordered w-full custom-input" 
                                            defaultValue="Netflix"
                                            required 
                                        />
                                        <select name="issue" className="select select-bordered w-full custom-input" defaultValue="Billing Issue" required>
                                            <option value="">What's the issue?</option>
                                            <option value="Billing Issue">Billing Issue</option>
                                            <option value="Technical Problem">Technical Problem</option>
                                            <option value="Account Access">Account Access</option>
                                            <option value="Service Outage">Service Outage</option>
                                            <option value="Refund Request">Refund Request</option>
                                            <option value="Feature Request">Feature Request</option>
                                            <option value="Other">Other</option>
                                        </select>
                                        <input 
                                            type="text" 
                                            name="accountInfo"
                                            placeholder="Account info (email, phone, account number)" 
                                            className="input input-bordered w-full custom-input" 
                                            defaultValue="john.smith@email.com"
                                            required 
                                        />
                                        <select name="urgency" className="select select-bordered w-full custom-input" defaultValue="Medium" required>
                                            <option value="">How urgent is this?</option>
                                            <option value="Low">Low - Can wait</option>
                                            <option value="Medium">Medium - Within 24 hours</option>
                                            <option value="High">High - ASAP</option>
                                            <option value="Critical">Critical - Service down</option>
                                        </select>
                                        <textarea 
                                            name="desiredOutcome"
                                            placeholder="What do you want to achieve with this call?" 
                                            className="textarea textarea-bordered w-full custom-input" 
                                            rows="3"
                                            defaultValue="I want to dispute a $15 charge that appeared on my account"
                                        />
                                        <button type="submit" className="custom-btn btn btn-sm w-full">Make Support Call</button>
                                    </div>
                                </form>
                            </div>
                        );
                        addMessage("I'll help you make that customer support call. Let me get the details first.", 'system', supportForm);
                    }, 1000);
                } else if (callType === "Personal Call") {
                    setTimeout(() => {
                        const personalForm = (
                            <div className="custom-card p-4 mt-2">
                                <h3 className="font-bold custom-accent mb-3">Personal Call Details</h3>
                                <form onSubmit={(e) => {
                                    e.preventDefault();
                                    const personalData = {
                                        recipient: e.target.recipient.value,
                                        relationship: e.target.relationship.value,
                                        purpose: e.target.purpose.value,
                                        message: e.target.message.value,
                                        tone: e.target.tone.value
                                    };
                                    handlePersonalCall(personalData);
                                }}>
                                    <div className="space-y-3">
                                        <input 
                                            type="text" 
                                            name="recipient"
                                            placeholder="Who are you calling? (Name)" 
                                            className="input input-bordered w-full custom-input" 
                                            defaultValue="Sarah Johnson"
                                            required 
                                        />
                                        <select name="relationship" className="select select-bordered w-full custom-input" defaultValue="Friend" required>
                                            <option value="">Relationship</option>
                                            <option value="Friend">Friend</option>
                                            <option value="Family">Family</option>
                                            <option value="Romantic Partner">Romantic Partner</option>
                                            <option value="Colleague">Colleague</option>
                                            <option value="Acquaintance">Acquaintance</option>
                                            <option value="Neighbor">Neighbor</option>
                                        </select>
                                        <select name="purpose" className="select select-bordered w-full custom-input" defaultValue="Invitation" required>
                                            <option value="">Purpose of call</option>
                                            <option value="Invitation">Invitation</option>
                                            <option value="Apology">Apology</option>
                                            <option value="Check-in">Check-in</option>
                                            <option value="Request">Request for help</option>
                                            <option value="Update">Share news/update</option>
                                            <option value="Plans">Make plans</option>
                                        </select>
                                        <select name="tone" className="select select-bordered w-full custom-input" defaultValue="Friendly" required>
                                            <option value="">Tone</option>
                                            <option value="Friendly">Friendly & casual</option>
                                            <option value="Formal">Formal & polite</option>
                                            <option value="Apologetic">Apologetic</option>
                                            <option value="Excited">Excited & enthusiastic</option>
                                            <option value="Concerned">Concerned & caring</option>
                                        </select>
                                        <textarea 
                                            name="message"
                                            placeholder="What do you want to say? (I'll make it sound natural)" 
                                            className="textarea textarea-bordered w-full custom-input" 
                                            rows="3"
                                            defaultValue="Hey Sarah, I was wondering if you'd like to go see the new Marvel movie this weekend? I heard it's really good and thought it would be fun to go together."
                                        />
                                        <button type="submit" className="custom-btn btn btn-sm w-full">Make Personal Call</button>
                                    </div>
                                </form>
                            </div>
                        );
                        addMessage("I'll help you make that personal call. Let me get the details so I can sound natural and friendly.", 'system', personalForm);
                    }, 1000);
                } else if (callType === "Complaint Call") {
                    setTimeout(() => {
                        const complaintForm = (
                            <div className="custom-card p-4 mt-2">
                                <h3 className="font-bold custom-accent mb-3">Complaint Call Details</h3>
                                <form onSubmit={(e) => {
                                    e.preventDefault();
                                    const complaintData = {
                                        company: e.target.company.value,
                                        issue: e.target.issue.value,
                                        impact: e.target.impact.value,
                                        desiredResolution: e.target.desiredResolution.value,
                                        evidence: e.target.evidence.value
                                    };
                                    handleComplaintCall(complaintData);
                                }}>
                                    <div className="space-y-3">
                                        <input 
                                            type="text" 
                                            name="company"
                                            placeholder="Company name" 
                                            className="input input-bordered w-full custom-input" 
                                            defaultValue="Uber"
                                            required 
                                        />
                                        <select name="issue" className="select select-bordered w-full custom-input" defaultValue="Poor Service" required>
                                            <option value="">What's the complaint?</option>
                                            <option value="Poor Service">Poor Service</option>
                                            <option value="Overcharged">Overcharged</option>
                                            <option value="Damaged Item">Damaged Item</option>
                                            <option value="Late Delivery">Late Delivery</option>
                                            <option value="Rude Staff">Rude Staff</option>
                                            <option value="False Advertising">False Advertising</option>
                                            <option value="Safety Issue">Safety Issue</option>
                                        </select>
                                        <select name="impact" className="select select-bordered w-full custom-input" defaultValue="Inconvenience" required>
                                            <option value="">Impact on you</option>
                                            <option value="Inconvenience">Minor inconvenience</option>
                                            <option value="Financial Loss">Financial loss</option>
                                            <option value="Time Wasted">Time wasted</option>
                                            <option value="Safety Concern">Safety concern</option>
                                            <option value="Emotional Distress">Emotional distress</option>
                                        </select>
                                        <select name="desiredResolution" className="select select-bordered w-full custom-input" defaultValue="Refund" required>
                                            <option value="">What do you want?</option>
                                            <option value="Refund">Full refund</option>
                                            <option value="Partial Refund">Partial refund</option>
                                            <option value="Replacement">Replacement</option>
                                            <option value="Apology">Apology</option>
                                            <option value="Policy Change">Policy change</option>
                                            <option value="Compensation">Compensation</option>
                                        </select>
                                        <textarea 
                                            name="evidence"
                                            placeholder="Evidence/details (receipt numbers, dates, etc.)" 
                                            className="textarea textarea-bordered w-full custom-input" 
                                            rows="3"
                                            defaultValue="Trip ID: 123456789, Date: Yesterday, Driver was 30 minutes late and the car was dirty"
                                        />
                                        <button type="submit" className="custom-btn btn btn-sm w-full">Make Complaint Call</button>
                                    </div>
                                </form>
                            </div>
                        );
                        addMessage("I'll help you make that complaint call professionally and effectively. Let me get the details.", 'system', complaintForm);
                    }, 1000);
                } else if (callType === "Cancel Subscription") {
                    setTimeout(() => {
                        const cancelForm = (
                            <div className="custom-card p-4 mt-2">
                                <h3 className="font-bold custom-accent mb-3">Subscription Cancellation</h3>
                                <form onSubmit={(e) => {
                                    e.preventDefault();
                                    const cancelData = {
                                        service: e.target.service.value,
                                        reason: e.target.reason.value,
                                        accountInfo: e.target.accountInfo.value,
                                        retentionOffer: e.target.retentionOffer.value
                                    };
                                    handleCancelCall(cancelData);
                                }}>
                                    <div className="space-y-3">
                                        <input 
                                            type="text" 
                                            name="service"
                                            placeholder="Service name (e.g., Spotify, Adobe, Gym membership)" 
                                            className="input input-bordered w-full custom-input" 
                                            defaultValue="Spotify"
                                            required 
                                        />
                                        <select name="reason" className="select select-bordered w-full custom-input" defaultValue="Too Expensive" required>
                                            <option value="">Why canceling?</option>
                                            <option value="Too Expensive">Too expensive</option>
                                            <option value="Not Using">Not using enough</option>
                                            <option value="Found Alternative">Found alternative</option>
                                            <option value="Technical Issues">Technical issues</option>
                                            <option value="Moving">Moving/changing situation</option>
                                            <option value="Other">Other reason</option>
                                        </select>
                                        <input 
                                            type="text" 
                                            name="accountInfo"
                                            placeholder="Account info (email, phone)" 
                                            className="input input-bordered w-full custom-input" 
                                            defaultValue="john.smith@email.com"
                                            required 
                                        />
                                        <select name="retentionOffer" className="select select-bordered w-full custom-input" defaultValue="No" required>
                                            <option value="">Open to retention offers?</option>
                                            <option value="No">No, just cancel</option>
                                            <option value="Maybe">Maybe if good deal</option>
                                            <option value="Yes">Yes, hear them out</option>
                                        </select>
                                        <button type="submit" className="custom-btn btn btn-sm w-full">Cancel Subscription</button>
                                    </div>
                                </form>
                            </div>
                        );
                        addMessage("I'll help you cancel that subscription. I know these calls can be tricky with retention tactics, so I'll be firm but polite.", 'system', cancelForm);
                    }, 1000);
                } else {
                    // Handle other call types (Business Call, Invite girlfriend to movies)
                    setTimeout(() => {
                        addMessageWithTyping(`I'll help you with that ${callType.toLowerCase()}. Let me make that call for you...`);
                    }, 1000);
                    setTimeout(() => {
                        showCallSimulation(callType);
                    }, 3000);
                }
            };

            // Handle support call
            const handleSupportCall = (supportData) => {
                addMessage(`Support call: ${supportData.company} - ${supportData.issue}`, 'user');
                setTimeout(() => {
                    addMessageWithTyping(`I'm calling ${supportData.company} customer support now to resolve your ${supportData.issue.toLowerCase()}...`);
                }, 1000);
                setTimeout(() => {
                    showSupportCallSimulation(supportData);
                }, 3000);
            };

            // Handle personal call
            const handlePersonalCall = (personalData) => {
                addMessage(`Personal call: ${personalData.recipient} - ${personalData.purpose}`, 'user');
                setTimeout(() => {
                    addMessageWithTyping(`I'm calling ${personalData.recipient} now with a ${personalData.tone.toLowerCase()} tone...`);
                }, 1000);
                setTimeout(() => {
                    showPersonalCallSimulation(personalData);
                }, 3000);
            };

            // Handle complaint call
            const handleComplaintCall = (complaintData) => {
                addMessage(`Complaint call: ${complaintData.company} - ${complaintData.issue}`, 'user');
                setTimeout(() => {
                    addMessageWithTyping(`I'm calling ${complaintData.company} now to file your complaint professionally...`);
                }, 1000);
                setTimeout(() => {
                    showComplaintCallSimulation(complaintData);
                }, 3000);
            };

            // Handle cancel call
            const handleCancelCall = (cancelData) => {
                addMessage(`Cancel call: ${cancelData.service} - ${cancelData.reason}`, 'user');
                setTimeout(() => {
                    addMessageWithTyping(`I'm calling ${cancelData.service} now to cancel your subscription...`);
                }, 1000);
                setTimeout(() => {
                    showCancelCallSimulation(cancelData);
                }, 3000);
            };

            // Show support call simulation
            const showSupportCallSimulation = (supportData) => {
                const userName = userProfile.personalInfo.name || "John";
                const userEmail = userProfile.personalInfo.email || "john@email.com";
                const isRepeatCustomer = userProfile.preferences.serviceHistory.some(s => s.type.includes("Support"));
                
                const callSteps = [
                    `Calling ${supportData.company} customer support...`,
                    "Navigating phone menu...",
                    "Connected to representative...",
                    `Explaining the issue: ${supportData.issue}...`,
                    `Providing account information: ${userEmail}...`,
                    isRepeatCustomer ? "Representative recognizes you as a valued customer..." : "First-time caller - explaining situation...",
                    "Negotiating resolution..."
                ];
                
                let currentStep = 0;
                const stepInterval = setInterval(() => {
                    if (currentStep < callSteps.length) {
                        addMessageWithTyping(callSteps[currentStep], 1000);
                        currentStep++;
                    } else {
                        clearInterval(stepInterval);
                        setTimeout(() => {
                            showCallResult(supportData, "Support Call", "Issue resolved! You received a $15 credit to your account.");
                        }, 2000);
                    }
                }, 2500);
            };

            // Show personal call simulation
            const showPersonalCallSimulation = (personalData) => {
                const callSteps = [
                    "Calling...",
                    "Phone ringing...",
                    "Connected!",
                    "Delivering your message...",
                    "Having a natural conversation...",
                    "Wrapping up..."
                ];
                
                let currentStep = 0;
                const stepInterval = setInterval(() => {
                    if (currentStep < callSteps.length) {
                        addMessageWithTyping(callSteps[currentStep], 800);
                        currentStep++;
                    } else {
                        clearInterval(stepInterval);
                        setTimeout(() => {
                            showCallResult(personalData, "Personal Call", `${personalData.recipient} said yes! She's excited about the movie and suggested Saturday evening.`);
                        }, 2000);
                    }
                }, 2000);
            };

            // Show complaint call simulation
            const showComplaintCallSimulation = (complaintData) => {
                const callSteps = [
                    "Calling company...",
                    "Speaking with manager...",
                    "Presenting your case...",
                    "Providing evidence...",
                    "Negotiating resolution...",
                    "Finalizing outcome..."
                ];
                
                let currentStep = 0;
                const stepInterval = setInterval(() => {
                    if (currentStep < callSteps.length) {
                        addMessageWithTyping(callSteps[currentStep], 1200);
                        currentStep++;
                    } else {
                        clearInterval(stepInterval);
                        setTimeout(() => {
                            showCallResult(complaintData, "Complaint Call", "Complaint resolved! You received a full refund of $25 and a $10 credit for the inconvenience.");
                        }, 2000);
                    }
                }, 3000);
            };

            // Show cancel call simulation
            const showCancelCallSimulation = (cancelData) => {
                const callSteps = [
                    "Calling retention department...",
                    "Explaining cancellation request...",
                    "Handling retention offers...",
                    "Staying firm on cancellation...",
                    "Processing cancellation...",
                    "Confirming cancellation..."
                ];
                
                let currentStep = 0;
                const stepInterval = setInterval(() => {
                    if (currentStep < callSteps.length) {
                        addMessageWithTyping(callSteps[currentStep], 1000);
                        currentStep++;
                    } else {
                        clearInterval(stepInterval);
                        setTimeout(() => {
                            showCallResult(cancelData, "Cancellation Call", "Subscription cancelled successfully! They offered 50% off for 3 months, but I declined as requested.");
                        }, 2000);
                    }
                }, 2500);
            };

            // Show call result
            const showCallResult = (callData, callType, result) => {
                const resultCard = (
                    <div className="custom-card border border-green-500 slide-up mt-2">
                        <div className="card-body">
                            <div className="flex items-center gap-3">
                                <svg xmlns="http://www.w3.org/2000/svg" className="stroke-current shrink-0 h-6 w-6 text-green-400" fill="none" viewBox="0 0 24 24">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                                <div>
                                    <h3 className="font-bold custom-text">{callType} Complete!</h3>
                                    <div className="text-xs custom-text-muted">
                                        {result}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                );
                
                addMessage(`Perfect! Your ${callType.toLowerCase()} is complete. Here's what happened:`, 'system', resultCard);
                
                setTimeout(() => {
                    addMessageWithTyping("I've sent you a summary of the call via email. The call recording is available in your account if you need to reference it later.");
                }, 2000);
                
                setTimeout(() => {
                    const continueButtons = (
                        <div className="space-y-3 mt-3">
                            <button 
                                className="custom-btn btn w-full"
                                onClick={() => handleScenarioSelect("booking")}
                            >
                                Book a service
                            </button>
                            <button 
                                className="custom-btn btn w-full"
                                onClick={() => handleScenarioSelect("calling")}
                            >
                                Make another call
                            </button>
                        </div>
                    );
                    addMessage("Is there anything else I can help you with today?", 'system', null, continueButtons);
                }, 4000);
            };

            // Show payment form
            const showPaymentForm = () => {
                setTimeout(() => {
                    const paymentForm = (
                        <div className="custom-card p-4 mt-2">
                            <h3 className="font-bold custom-accent mb-3">Payment Information</h3>
                            <form onSubmit={(e) => {
                                e.preventDefault();
                                const paymentData = {
                                    cardNumber: e.target.cardNumber.value,
                                    expiryDate: e.target.expiryDate.value,
                                    cvv: e.target.cvv.value,
                                    name: e.target.name.value
                                };
                                handlePaymentSubmit(paymentData);
                            }}>
                                <div className="space-y-3">
                                    <input 
                                        type="text" 
                                        name="cardNumber"
                                        placeholder="Card Number" 
                                        className="input input-bordered w-full custom-input" 
                                        defaultValue="4532 1234 5678 9012"
                                        required 
                                    />
                                    <div className="grid grid-cols-2 gap-3">
                                        <input 
                                            type="text" 
                                            name="expiryDate"
                                            placeholder="MM/YY" 
                                            className="input input-bordered w-full custom-input" 
                                            defaultValue="12/25"
                                            required 
                                        />
                                        <input 
                                            type="text" 
                                            name="cvv"
                                            placeholder="CVV" 
                                            className="input input-bordered w-full custom-input" 
                                            defaultValue="123"
                                            required 
                                        />
                                    </div>
                                    <input 
                                        type="text" 
                                        name="name"
                                        placeholder="Cardholder Name" 
                                        className="input input-bordered w-full custom-input" 
                                        defaultValue="John Smith"
                                        required 
                                    />
                                    <button type="submit" className="custom-btn btn btn-sm w-full">
                                        Complete Booking
                                    </button>
                                </div>
                            </form>
                        </div>
                    );
                    addMessage("Great! Now I need your payment information to complete the booking.", 'system', paymentForm);
                }, 1000);
            };

            // Handle payment form submission - NEW CLEAN VERSION
            const handlePaymentSubmit = (paymentData) => {
                // Save payment info to user profile
                setUserProfile(prev => ({
                    ...prev,
                    paymentInfo: {
                        ...prev.paymentInfo,
                        cardNumber: paymentData.cardNumber,
                        expiryDate: paymentData.expiryDate,
                        cvv: paymentData.cvv,
                        cardName: paymentData.name
                    }
                }));
                
                const fullData = { ...userData, ...paymentData };
                setUserData(fullData);
                addMessage(`Payment: ${paymentData.cardNumber}`, 'user');
                
                // Check if we have a pending booking to complete
                console.log('handlePaymentSubmit - pendingBooking state:', pendingBooking); // Debug log
                console.log('handlePaymentSubmit - pendingBooking ref:', pendingBookingRef.current); // Debug log
                
                const currentPendingBooking = pendingBookingRef.current || pendingBooking;
                if (currentPendingBooking) {
                    console.log('Processing pending booking:', currentPendingBooking.type); // Debug log
                setTimeout(() => {
                        if (currentPendingBooking.type === 'medical') {
                            console.log('Calling processMedicalBooking from payment submit'); // Debug log
                            processMedicalBooking(currentPendingBooking.center, currentPendingBooking.appointmentData);
                        } else if (currentPendingBooking.type === 'restaurant') {
                            showRestaurantCallSimulation(currentPendingBooking.restaurant, currentPendingBooking.preferences);
                        } else if (currentPendingBooking.type === 'cleaning') {
                            showServiceConfirmation(currentPendingBooking.service, currentPendingBooking.preferences, "Cleaning Service");
                        } else if (currentPendingBooking.type === 'beauty') {
                            showServiceConfirmation(currentPendingBooking.service, currentPendingBooking.preferences, "Beauty Salon");
                        }
                        setPendingBooking(null); // Clear pending booking
                        pendingBookingRef.current = null; // Clear ref
                }, 1000);
                    return;
                }

                // If no pending booking, route to appropriate service based on serviceType
                setTimeout(() => {
                    const serviceType = userData.serviceType;
                    if (serviceType === "Restaurant Reservation") {
                        showRestaurantOptions(userData);
                    } else if (serviceType === "Cleaning Service") {
                        showCleaningOptions(userData);
                    } else if (serviceType === "Beauty Salon") {
                        showBeautyOptions(userData);
                    } else if (serviceType === "Doctor Appointment" || serviceType === "Medical Center") {
                        // For medical services, show the medical appointment options
                        showMedicalAppointmentOptions(userData);
                    } else {
                        // Default fallback - show service selection
                        addMessageWithTyping("I have your payment information. What type of service would you like me to help you with?");
                    }
                }, 1000);
            };

            // Handle custom message input
            const handleCustomMessage = () => {
                if (customMessage.trim() === '') return;
                
                setMessages(prev => [...prev, {
                    type: 'user',
                    text: customMessage,
                    timestamp: new Date(),
                    id: Date.now()
                }]);

                const message = customMessage.toLowerCase();
                setCustomMessage('');
                
                // Simulate AI response to custom message based on content
                setTimeout(() => {
                    if (message.includes('doctor') || message.includes('medical') || message.includes('appointment')) {
                        // Reduce minutes for medical calls
                        setRemainingMinutes(prev => Math.max(0, prev - 1));
                        addMessageWithTyping("I understand you need medical assistance. I'll find the best doctors and clinics for you and make all the calls. No need for you to call anyone!");
                        setShowForm(true);
                    } else if (message.includes('clean') || message.includes('cleaning') || message.includes('housekeeper')) {
                        // Reduce minutes for cleaning calls
                        setRemainingMinutes(prev => Math.max(0, prev - 1));
                        addMessageWithTyping("I'll help you find the best cleaning service. I'll call cleaning companies and arrange everything for you.");
                        setShowForm(true);
                    } else if (message.includes('restaurant') || message.includes('dinner') || message.includes('lunch') || message.includes('food')) {
                        // Reduce minutes for restaurant calls
                        setRemainingMinutes(prev => Math.max(0, prev - 1));
                        addMessageWithTyping("I'll find the perfect restaurant for you and make the reservation. I'll handle all the calling!");
                        setShowForm(true);
                    } else if (message.includes('hair') || message.includes('salon') || message.includes('beauty') || message.includes('manicure')) {
                        // Reduce minutes for salon calls
                        setRemainingMinutes(prev => Math.max(0, prev - 1));
                        addMessageWithTyping("I'll book you at the best beauty salon. I'll call salons and arrange your appointment.");
                        setShowForm(true);
                    } else if (message.includes('taxi') || message.includes('ride') || message.includes('uber') || message.includes('transport')) {
                        // Reduce minutes for taxi calls
                        setRemainingMinutes(prev => Math.max(0, prev - 1));
                        addMessageWithTyping("I'll arrange transportation for you. I'll call taxi services and find the best option.");
                        setShowForm(true);
                    } else if (message.includes('movie') || message.includes('cinema') || message.includes('date') || message.includes('girlfriend') || message.includes('boyfriend') || message.includes('invite')) {
                        // Reduce minutes for personal calls
                        setRemainingMinutes(prev => Math.max(0, prev - 1));
                        addMessageWithTyping("I'll help you invite your girlfriend to the movies! Let me call her and arrange a nice date for you.");
                        
                        setTimeout(() => {
                            addMessageWithTyping("Calling your girlfriend...");
                        }, 2000);
                        
                        setTimeout(() => {
                            addMessageWithTyping("Hi [Girlfriend's name], it's your boyfriend calling through his AI assistant. He wanted me to invite you to the movies this weekend. There's a new romantic comedy playing that he thinks you'd love!");
                        }, 4000);
                        
                        setTimeout(() => {
                            addMessageWithTyping("Response: 'Oh my gosh, that sounds amazing! I'd love to go to the movies with him. What time were you thinking?'");
                        }, 6000);
                        
                        setTimeout(() => {
                            addMessageWithTyping("Great! I've arranged a movie date for this Saturday at 7 PM. I'll book the tickets and send you both the details. Have a wonderful time!");
                        }, 8000);
                        
                        setTimeout(() => {
                            addMessageWithTyping("Date arranged successfully! Your girlfriend is excited about the movie night. I've booked tickets for Saturday 7 PM and sent both of you the confirmation details.");
                        }, 10000);
                    } else {
                        // Reduce minutes for general calls
                        setRemainingMinutes(prev => Math.max(0, prev - 1));
                        addMessageWithTyping("I understand your request. Let me help you with that. I'll call the relevant places and arrange everything for you. No need for you to make any calls!");
                        setShowForm(true);
                    }
                }, 1500);
            };


            // Get service cards based on current scenario
            const getServiceCards = () => {
                const lastUserMessage = messages.filter(m => m.type === 'user').pop()?.text || '';
                
                if (lastUserMessage.includes('doctor') || lastUserMessage.includes('medical') || userData.serviceType === "Doctor Appointment") {
                    const budget = userData.budget || "$100-200";
                    const insurance = userData.insurance || "Standard Insurance";
                    const doctorType = userData.doctorType || "General Practitioner";
                    
                    // Filter clinics based on budget and insurance
                    let clinics = [
                        {
                            name: "City Medical Center",
                            rating: 4.8,
                            summary: "Available tomorrow at 2:00 PM",
                            comments: `Accepts ${insurance}, ${doctorType} available`,
                            price: "$120",
                            acceptsInsurance: ["Standard Insurance", "Premium Insurance", "Basic Insurance"],
                            budgetRange: "$100-200"
                        },
                        {
                            name: "Family Health Center",
                            rating: 4.6,
                            summary: "Available day after tomorrow at 10:00 AM",
                            comments: `Accepts ${insurance}, friendly staff`,
                            price: "$95",
                            acceptsInsurance: ["Standard Insurance", "Family Plan", "Government Insurance"],
                            budgetRange: "$50-100"
                        },
                        {
                            name: "Premium Medical Group",
                            rating: 4.9,
                            summary: "Available next week, flexible timing",
                            comments: `Accepts ${insurance}, top-rated ${doctorType}`,
                            price: "$150",
                            acceptsInsurance: ["Standard Insurance", "Premium Insurance", "Basic Insurance", "Family Plan"],
                            budgetRange: "$200-300"
                        },
                        {
                            name: "Community Health Clinic",
                            rating: 4.4,
                            summary: "Available this week",
                            comments: `Accepts ${insurance}, affordable care`,
                            price: "$75",
                            acceptsInsurance: ["Government Insurance", "Senior Insurance", "Standard Insurance"],
                            budgetRange: "$50-100"
                        },
                        {
                            name: "Specialty Care Center",
                            rating: 4.7,
                            summary: "Available next week",
                            comments: `Accepts ${insurance}, specialized ${doctorType} care`,
                            price: "$180",
                            acceptsInsurance: ["Standard Insurance", "Premium Insurance", "Basic Insurance"],
                            budgetRange: "$200-300"
                        }
                    ];
                    
                    // Filter by insurance acceptance and budget
                    return clinics.filter(clinic => 
                        clinic.acceptsInsurance.includes(insurance) && 
                        clinic.budgetRange === budget
                    ).slice(0, 3);
                } else if (lastUserMessage.includes('cleaning')) {
                    return [
                        {
                            name: "Sparkle Clean Services",
                            rating: 4.7,
                            summary: "Available this weekend",
                            comments: "Professional team, eco-friendly products",
                            price: "$80"
                        },
                        {
                            name: "Home Fresh Cleaning",
                            rating: 4.5,
                            summary: "Available next week",
                            comments: "Reliable service, insured cleaners",
                            price: "$65"
                        },
                        {
                            name: "Premium Clean Co.",
                            rating: 4.9,
                            summary: "Available tomorrow",
                            comments: "Luxury service, white-glove treatment",
                            price: "$120"
                        }
                    ];
                } else if (lastUserMessage.includes('restaurant')) {
                    return [
                        {
                            name: "Bella Vista Restaurant",
                            rating: 4.8,
                            summary: "Table for 2, tomorrow 7:00 PM",
                            comments: "Italian cuisine, romantic atmosphere",
                            price: "$45/person"
                        },
                        {
                            name: "The Garden Bistro",
                            rating: 4.6,
                            summary: "Table for 2, day after tomorrow 6:30 PM",
                            comments: "Farm-to-table, outdoor seating",
                            price: "$35/person"
                        },
                        {
                            name: "Chef's Table",
                            rating: 4.9,
                            summary: "Table for 2, next week 8:00 PM",
                            comments: "Fine dining, tasting menu",
                            price: "$85/person"
                        }
                    ];
                } else if (lastUserMessage.includes('salon') || lastUserMessage.includes('beauty')) {
                    return [
                        {
                            name: "Glamour Studio",
                            rating: 4.7,
                            summary: "Available tomorrow 2:00 PM",
                            comments: "Expert stylists, modern techniques",
                            price: "$75"
                        },
                        {
                            name: "Beauty Haven",
                            rating: 4.5,
                            summary: "Available day after tomorrow 10:00 AM",
                            comments: "Relaxing atmosphere, skilled professionals",
                            price: "$60"
                        },
                        {
                            name: "Luxury Spa & Salon",
                            rating: 4.9,
                            summary: "Available next week",
                            comments: "Premium services, full spa experience",
                            price: "$120"
                        }
                    ];
                } else if (lastUserMessage.includes('taxi') || lastUserMessage.includes('ride')) {
                    return [
                        {
                            name: "City Taxi",
                            rating: 4.7,
                            summary: "ETA: 3-5 minutes",
                            comments: "Professional driver, clean car",
                            price: "$15-20"
                        },
                        {
                            name: "Express Ride",
                            rating: 4.5,
                            summary: "ETA: 5-8 minutes",
                            comments: "Economy option, reliable",
                            price: "$12-18"
                        },
                        {
                            name: "Premium Transport",
                            rating: 4.9,
                            summary: "ETA: 2-4 minutes",
                            comments: "Luxury car, experienced driver",
                            price: "$25-30"
                        }
                    ];
                } else if (lastUserMessage.includes('support') || lastUserMessage.includes('customer')) {
                    return [
                        {
                            name: "Customer Support Call",
                            rating: 4.8,
                            summary: "Resolved billing issue",
                            comments: "Friendly representative, quick resolution",
                            price: "Free"
                        },
                        {
                            name: "Technical Support Call",
                            rating: 4.6,
                            summary: "Issue resolved successfully",
                            comments: "Professional service, clear instructions",
                            price: "Free"
                        },
                        {
                            name: "Account Support Call",
                            rating: 4.9,
                            summary: "Account updated successfully",
                            comments: "Helpful representative, quick service",
                            price: "Free"
                        }
                    ];
                } else if (lastUserMessage.includes('delivery')) {
                    return [
                        {
                            name: "Delivery Service Call",
                            rating: 4.6,
                            summary: "Order status updated",
                            comments: "Professional service, on-time delivery",
                            price: "Free"
                        },
                        {
                            name: "Food Delivery Call",
                            rating: 4.7,
                            summary: "Order confirmed and tracking provided",
                            comments: "Friendly service, accurate delivery time",
                            price: "Free"
                        },
                        {
                            name: "Package Delivery Call",
                            rating: 4.8,
                            summary: "Delivery scheduled successfully",
                            comments: "Reliable service, clear communication",
                            price: "Free"
                        }
                    ];
                } else if (lastUserMessage.includes('movie') || lastUserMessage.includes('girlfriend') || lastUserMessage.includes('invite')) {
                    return [
                        {
                            name: "Movie Date Call",
                            rating: 4.9,
                            summary: "Date arranged successfully",
                            comments: "Romantic conversation, excited response",
                            price: "Free"
                        },
                        {
                            name: "Personal Invitation Call",
                            rating: 4.8,
                            summary: "Invitation accepted with enthusiasm",
                            comments: "Sweet conversation, positive outcome",
                            price: "Free"
                        },
                        {
                            name: "Relationship Call",
                            rating: 4.9,
                            summary: "Message delivered with care",
                            comments: "Respectful conversation, clear communication",
                            price: "Free"
                        }
                    ];
                } else if (lastUserMessage.includes('family') || lastUserMessage.includes('friends')) {
                    return [
                        {
                            name: "Family Call",
                            rating: 4.8,
                            summary: "Message delivered successfully",
                            comments: "Warm conversation, family connection",
                            price: "Free"
                        },
                        {
                            name: "Friends Call",
                            rating: 4.7,
                            summary: "Plans made successfully",
                            comments: "Friendly conversation, positive response",
                            price: "Free"
                        },
                        {
                            name: "Personal Call",
                            rating: 4.9,
                            summary: "Message delivered with care",
                            comments: "Respectful conversation, clear communication",
                            price: "Free"
                        }
                    ];
                }
                
                // Default to medical services
                return [
                    {
                        name: "City Dental Clinic",
                        rating: 4.8,
                        summary: "Available tomorrow at 2:00 PM",
                        comments: "Modern equipment, experienced dentists",
                        price: "$120"
                    },
                    {
                        name: "Family Health Center",
                        rating: 4.6,
                        summary: "Available day after tomorrow at 10:00 AM",
                        comments: "Friendly staff, good reviews",
                        price: "$95"
                    },
                    {
                        name: "Premium Medical Group",
                        rating: 4.9,
                        summary: "Available next week, flexible timing",
                        comments: "Top-rated facility, comprehensive care",
                        price: "$150"
                    }
                ];
            };

            // Handle service selection
            const handleServiceSelect = (service) => {
                addMessage(`I choose: ${service.name}`, 'user');
                // Карточки клиник остаются видимыми
                
                setTimeout(() => {
                    addMessageWithTyping(`Perfect! I've successfully booked your service at ${service.name}.`);
                }, 1000);

                setTimeout(() => {
                    const successCard = (
                        <div className="custom-card border border-green-500 slide-up mt-2">
                            <div className="card-body">
                                <div className="flex items-center gap-3">
                                    <svg xmlns="http://www.w3.org/2000/svg" className="stroke-current shrink-0 h-6 w-6 text-green-400" fill="none" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                                    </svg>
                                    <div>
                                        <h3 className="font-bold custom-text">Booking Confirmed!</h3>
                                        <div className="text-xs custom-text-muted">Booking confirmed at {service.name} for {service.price}</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    );
                    addMessage(`Confirmation email sent to your email address\nSMS reminder will be sent 24 hours before\nPayment processed: ${service.price}\nService confirmed for tomorrow at 2:00 PM`, 'system', successCard);
                }, 2500);

                setTimeout(() => {
                    const continueButtons = (
                        <div className="space-y-3 mt-3">
                            <button 
                                className="custom-btn btn w-full"
                                onClick={() => handleScenarioSelect("booking")}
                            >
                                Book another service
                            </button>
                            <button 
                                className="custom-btn btn w-full"
                                onClick={() => handleScenarioSelect("calling")}
                            >
                                Make another call
                            </button>
                        </div>
                    );
                    addMessage("Is there anything else I can help you with? You can book another service or ask me anything!", 'system', null, continueButtons);
                }, 4500);
            };

            // Landing page
            if (currentStep === 'landing') {
                return (
                    <div className="min-h-screen custom-bg flex items-center justify-center p-4">
                        <div className="w-full max-w-6xl">
                            <div className="grid md:grid-cols-2 gap-12 items-center mb-12">
                                <div className="text-center md:text-left">
                                    <h1 className="text-6xl font-bold custom-accent mb-6">
                                        Zaico
                                    </h1>
                                    <p className="text-2xl custom-text-muted mb-8">
                                        AI Concierge for Gen Z
                                    </p>
                                    <p className="text-lg custom-text mb-8">
                                        Never make another phone call again. Our AI assistant handles all your calls, 
                                        bookings, and arrangements so you can focus on what matters most.
                                    </p>
                                </div>
                                <div className="flex justify-center md:justify-end">
                                    <img 
                                        src="https://i.ibb.co/R4JLgLDz/download-4.png" 
                                        alt="Zaico AI Assistant" 
                                        className="w-64 h-64 md:w-80 md:h-80 object-contain"
                                        style={{maxWidth: '100%', height: 'auto'}}
                                    />
                                </div>
                            </div>

                            <div className="grid md:grid-cols-3 gap-8 mb-12">
                                <div className="custom-card p-6 text-center slide-in-left">
                                    <h3 className="text-xl font-bold custom-accent mb-3">Phone Anxiety Relief</h3>
                                    <p className="custom-text-muted">
                                        No more stress about calling doctors, restaurants, or services. 
                                        We handle all the awkward conversations for you.
                                    </p>
                                </div>
                                
                                <div className="custom-card p-6 text-center slide-up">
                                    <h3 className="text-xl font-bold custom-accent mb-3">AI-Powered</h3>
                                    <p className="custom-text-muted">
                                        Advanced AI that understands context, makes decisions, and negotiates on your behalf with human-like conversation.
                                    </p>
                                </div>
                                
                                <div className="custom-card p-6 text-center slide-in-right">
                                    <h3 className="text-xl font-bold custom-accent mb-3">Instant Results</h3>
                                    <p className="custom-text-muted">
                                        Get appointments, reservations, and services arranged in minutes, not hours of phone tag and waiting.
                                    </p>
                                </div>
                            </div>

                            <div className="text-center">
                                <div className="flex gap-4 justify-center mb-4">
                                    <button 
                                        className="custom-btn btn btn-lg px-12 py-4 text-lg pulse-glow scale-in"
                                        onClick={startDemo}
                                    >
                                        Run Demo
                                    </button>
                                    <button 
                                        className="custom-btn btn btn-outline btn-lg px-8 py-4 text-lg slide-in-right"
                                        onClick={() => setCurrentStep('investors')}
                                    >
                                        Investors
                                    </button>
                                </div>
                                <p className="custom-text-muted mt-4 text-sm slide-in-left">
                                    Experience how Zaico eliminates phone calls from your life
                                </p>
                            </div>
                        </div>
                    </div>
                );
            }

            // Define slides array
            const slides = [
                {
                    title: "1. Problem",
                    content: (
                        <div className="space-y-3">
                            <div className="flex items-center gap-3">
                                <div className="w-8 h-8 bg-red-500 rounded-full flex items-center justify-center text-white font-bold">1</div>
                            <p className="custom-text">For Gen Z, phone calls are one of the most stressful everyday tasks</p>
                            </div>
                            <div className="flex items-center gap-3">
                                <div className="w-8 h-8 bg-red-500 rounded-full flex items-center justify-center text-white font-bold">2</div>
                            <p className="custom-text">Doctors, salons, real estate, local services → still phone-gated</p>
                            </div>
                            <div className="flex items-center gap-3">
                                <div className="w-8 h-8 bg-red-500 rounded-full flex items-center justify-center text-white font-bold">3</div>
                            <p className="custom-text">Phone anxiety blocks millions from solving basic needs</p>
                            </div>
                        </div>
                    )
                },
                {
                    title: "2. Problem Proof – Gen Z hates phone calls",
                    content: (
                        <div className="space-y-3">
                            <div className="bg-red-900/20 p-4 rounded border-l-4 border-red-500">
                                <p className="custom-text"><strong>59%</strong> of young workers prefer texting over calling (Robert Walters, 2022)</p>
                            </div>
                            <div className="bg-red-900/20 p-4 rounded border-l-4 border-red-500">
                                <p className="custom-text"><strong>87%</strong> of Gen Z in Australia avoid unpleasant calls (CommBank, 2023)</p>
                            </div>
                            <div className="bg-red-900/20 p-4 rounded border-l-4 border-red-500">
                                <p className="custom-text"><strong>26%</strong> of Gen Z in UK actively avoid calls (Sky, 2022)</p>
                            </div>
                            <p className="custom-text-muted">Cultural shift: calls have become a pain point for the younger generation.</p>
                        </div>
                    )
                },
                {
                    title: "3. Solution",
                    content: (
                        <div className="space-y-3">
                            <div className="flex items-center gap-3">
                                <div className="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center text-white font-bold">1</div>
                            <p className="custom-text"><strong>Zaico</strong> – AI concierge that makes every call for you</p>
                            </div>
                            <div className="flex items-center gap-3">
                                <div className="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center text-white font-bold">2</div>
                            <p className="custom-text">Books, arranges, pays, and confirms</p>
                            </div>
                            <div className="flex items-center gap-3">
                                <div className="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center text-white font-bold">3</div>
                            <p className="custom-text">Works via simple text input</p>
                            </div>
                            <div className="flex items-center gap-3">
                                <div className="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center text-white font-bold">4</div>
                            <p className="custom-text"><strong>You never have to pick up the phone again</strong></p>
                            </div>
                        </div>
                    )
                },
                {
                    title: "4. How It Works",
                    content: (
                        <div className="space-y-3">
                            <div className="flex items-center gap-3">
                                <div className="w-8 h-8 bg-purple-500 rounded-full flex items-center justify-center text-white font-bold">1</div>
                                <p className="custom-text">User types: "Book a doctor's appointment"</p>
                            </div>
                            <div className="flex items-center gap-3">
                                <div className="w-8 h-8 bg-purple-500 rounded-full flex items-center justify-center text-white font-bold">2</div>
                                <p className="custom-text">Zaico calls clinics, checks availability</p>
                            </div>
                            <div className="flex items-center gap-3">
                                <div className="w-8 h-8 bg-purple-500 rounded-full flex items-center justify-center text-white font-bold">3</div>
                                <p className="custom-text">User chooses preferred option</p>
                            </div>
                            <div className="flex items-center gap-3">
                                <div className="w-8 h-8 bg-purple-500 rounded-full flex items-center justify-center text-white font-bold">4</div>
                                <p className="custom-text">Zaico books, processes payment, sends confirmation & reminder</p>
                            </div>
                            <p className="custom-text-muted">➡ Appointment done. No calls made.</p>
                        </div>
                    )
                },
                {
                    title: "5. Competition",
                    content: (
                        <div className="space-y-4">
                            <div className="bg-red-900/20 p-4 rounded border-l-4 border-red-500">
                                <h3 className="font-bold custom-accent mb-2">Google Duplex</h3>
                                <div className="space-y-2 text-sm">
                                    <p className="custom-text">• Only narrow domains, limited devices & regions</p>
                                    <p className="custom-text">• Geo & language limits: weak with accents/dialects</p>
                                    <p className="custom-text">• Privacy barriers: GDPR/HIPAA restrict usage</p>
                                </div>
                            </div>
                            <div className="bg-yellow-900/20 p-4 rounded border-l-4 border-yellow-500">
                                <h3 className="font-bold custom-accent mb-2">Big Tech Limitations</h3>
                                <div className="space-y-2 text-sm">
                                    <p className="custom-text">• No clear market leader yet</p>
                                    <p className="custom-text">• Weak localization and customization</p>
                                    <p className="custom-text">• Privacy and compliance restrictions</p>
                                </div>
                            </div>
                            <p className="custom-text-muted">Big Tech doesn't cover localization, customization, and privacy → Zaico = more flexible, faster, closer to market.</p>
                        </div>
                    )
                },
                {
                    title: "6. Market Opportunity",
                    content: (
                        <div className="space-y-3">
                            <div className="flex items-center gap-3">
                                <div className="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center text-white font-bold">1</div>
                            <p className="custom-text"><strong>$100B+</strong> global spend on healthcare, beauty, real estate, local services</p>
                            </div>
                            <div className="flex items-center gap-3">
                                <div className="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center text-white font-bold">2</div>
                            <p className="custom-text">All categories depend on phone-based booking</p>
                            </div>
                            <div className="flex items-center gap-3">
                                <div className="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center text-white font-bold">3</div>
                            <p className="custom-text"><strong>Zaico = universal AI interface to offline services</strong></p>
                            </div>
                        </div>
                    )
                },
                {
                    title: "7. Business Model",
                    content: (
                        <div className="space-y-4">
                            <div className="grid md:grid-cols-3 gap-4">
                                <div className="bg-purple-900/20 p-4 rounded border-l-4 border-purple-500">
                                    <h3 className="font-bold custom-accent mb-2">Pay-as-you-go</h3>
                                    <p className="custom-text text-sm">Buy minutes ($4.49 – $29.99 packs)</p>
                                </div>
                                <div className="bg-blue-900/20 p-4 rounded border-l-4 border-blue-500">
                                    <h3 className="font-bold custom-accent mb-2">Virtual Numbers</h3>
                                    <p className="custom-text text-sm">$14.99 one-time (SMS, calls, banking, couriers)</p>
                                </div>
                                <div className="bg-green-900/20 p-4 rounded border-l-4 border-green-500">
                                    <h3 className="font-bold custom-accent mb-2">Subscriptions</h3>
                                    <p className="custom-text text-sm">Basic $9.99/mo, Pro $19.99/mo, Business $29.99/mo</p>
                                </div>
                            </div>
                            <div className="bg-orange-900/20 p-4 rounded border-l-4 border-orange-500">
                                <h4 className="font-bold custom-accent mb-2">Monetization Logic</h4>
                                <div className="space-y-1 text-sm">
                                    <p className="custom-text">• Minutes → расходный материал (дорогие, чтобы стимулировать подписку)</p>
                                    <p className="custom-text">• Персональный номер → core-продукт, без него сервис не имеет смысла</p>
                                    <p className="custom-text">• Подписка с AI-консьержем → главный источник регулярного дохода (MONEY MACHINE 💰)</p>
                                </div>
                            </div>
                        </div>
                    )
                },
                {
                    title: "8. Unit Economics",
                    content: (
                        <div className="space-y-4">
                            <div className="mb-4 p-4 bg-blue-900/20 rounded border-l-4 border-blue-500">
                                <p className="custom-text text-sm"><strong>Assumptions:</strong> CAC ~$5.3, Gross Margin 75%, Lifetime ~12 months</p>
                            </div>
                            <div className="overflow-x-auto">
                                <table className="table table-zebra w-full">
                                    <thead>
                                        <tr>
                                            <th className="custom-text">ARPU</th>
                                            <th className="custom-text">LTV</th>
                                            <th className="custom-text">LTV:CAC</th>
                                            <th className="custom-text">Payback</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td className="custom-text">$20 (Optimistic)</td>
                                            <td className="custom-text">$180</td>
                                            <td className="custom-text">34x</td>
                                            <td className="custom-text">0.35 mo</td>
                                        </tr>
                                        <tr>
                                            <td className="custom-text">$15 (Base)</td>
                                            <td className="custom-text">$135</td>
                                            <td className="custom-text">25x</td>
                                            <td className="custom-text">0.47 mo</td>
                                        </tr>
                                        <tr>
                                            <td className="custom-text">$10 (Conservative)</td>
                                            <td className="custom-text">$90</td>
                                            <td className="custom-text">17x</td>
                                            <td className="custom-text">0.7 mo</td>
                                        </tr>
                                        <tr>
                                            <td className="custom-text">$5 (Stress)</td>
                                            <td className="custom-text">$45</td>
                                            <td className="custom-text">8.5x</td>
                                            <td className="custom-text">1.4 mo</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <p className="custom-text-muted mt-3">Even in stress-case: CAC pays back &lt;2 months, LTV:CAC &gt;8x.</p>
                        </div>
                    )
                },
                {
                    title: "9. Financial Projections",
                    content: (
                        <div className="space-y-6">
                            <div className="grid md:grid-cols-2 gap-6">
                                <div>
                                    <h3 className="font-bold custom-accent mb-3">User Growth (12–24 months)</h3>
                                    <div className="space-y-2">
                                        <p className="custom-text">M0: 500 beta users</p>
                                        <p className="custom-text">M6: 10,000</p>
                                        <p className="custom-text">M12: 50,000</p>
                                        <p className="custom-text">M24: 250,000+</p>
                                    </div>
                                </div>
                                <div>
                                    <h3 className="font-bold custom-accent mb-3">Revenue Forecast</h3>
                                    <div className="space-y-2">
                                        <p className="custom-text">Year 1: ~$6M ARR</p>
                                        <p className="custom-text">Year 2: ~$25M ARR</p>
                                        <p className="custom-text">Year 3: ~$75M ARR</p>
                                    </div>
                                </div>
                            </div>
                            <div className="mt-6 p-4 bg-green-900/20 rounded border-l-4 border-green-500">
                                <h4 className="font-bold custom-accent mb-2">Unit Economics Summary</h4>
                                <div className="grid md:grid-cols-3 gap-4 text-sm">
                                    <div>
                                        <p className="custom-text"><strong>Gross Margin:</strong> 75–80%</p>
                                    </div>
                                    <div>
                                        <p className="custom-text"><strong>Payback:</strong> &lt; 6 months</p>
                                    </div>
                                    <div>
                                        <p className="custom-text"><strong>Growth Rate:</strong> 20x in 2 years</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )
                },
                {
                    title: "10. Fundraising",
                    content: (
                        <div className="space-y-6">
                            <div className="grid md:grid-cols-2 gap-6">
                                <div>
                                    <div className="space-y-3">
                                        <p className="custom-text"><strong>Raising:</strong> $600k</p>
                                        <p className="custom-text"><strong>Equity:</strong> 5%</p>
                                        <p className="custom-text"><strong>Valuation:</strong> $12M pre-money</p>
                                        <p className="custom-text"><strong>Runway:</strong> ~18 months</p>
                                    </div>
                                    <div className="mt-4 p-3 bg-purple-900/20 rounded">
                                        <p className="custom-text text-sm"><strong>Post-money:</strong> $12.6M</p>
                                        <p className="custom-text text-sm"><strong>Target:</strong> Pre-seed investors</p>
                                    </div>
                                </div>
                                <div>
                                    <h3 className="font-bold custom-accent mb-3">Use of Funds</h3>
                                    <div className="space-y-2">
                                        <div className="flex items-center gap-3">
                                            <div className="w-6 h-6 bg-orange-500 rounded-full flex items-center justify-center text-white font-bold text-sm">1</div>
                                            <p className="custom-text">Product development & AI infra</p>
                                        </div>
                                        <div className="flex items-center gap-3">
                                            <div className="w-6 h-6 bg-orange-500 rounded-full flex items-center justify-center text-white font-bold text-sm">2</div>
                                            <p className="custom-text">Growth → 50k users</p>
                                        </div>
                                        <div className="flex items-center gap-3">
                                            <div className="w-6 h-6 bg-orange-500 rounded-full flex items-center justify-center text-white font-bold text-sm">3</div>
                                            <p className="custom-text">SMB integrations</p>
                                        </div>
                                        <div className="flex items-center gap-3">
                                            <div className="w-6 h-6 bg-orange-500 rounded-full flex items-center justify-center text-white font-bold text-sm">4</div>
                                            <p className="custom-text">Team expansion (engineering, AI, GTM)</p>
                                        </div>
                                    </div>
                                    <div className="mt-4 p-3 bg-orange-900/20 rounded">
                                        <h4 className="font-bold custom-accent mb-2 text-sm">Milestones (18 months)</h4>
                                        <div className="space-y-1 text-sm">
                                            <div className="flex items-center gap-2">
                                                <div className="w-4 h-4 bg-orange-500 rounded-full flex items-center justify-center text-white font-bold text-xs">1</div>
                                                <p className="custom-text">50k active users</p>
                                        </div>
                                            <div className="flex items-center gap-2">
                                                <div className="w-4 h-4 bg-orange-500 rounded-full flex items-center justify-center text-white font-bold text-xs">2</div>
                                                <p className="custom-text">$500k ARR</p>
                                            </div>
                                            <div className="flex items-center gap-2">
                                                <div className="w-4 h-4 bg-orange-500 rounded-full flex items-center justify-center text-white font-bold text-xs">3</div>
                                                <p className="custom-text">Seed round ready</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )
                },
                {
                    title: "11. Team",
                    content: (
                        <div className="grid md:grid-cols-2 gap-6">
                            <div className="space-y-4">
                                <div className="bg-purple-900/20 p-4 rounded border-l-4 border-purple-500">
                                    <h3 className="font-bold custom-accent mb-2">Gleb Ikonnikov – CEO & CTO</h3>
                                    <p className="custom-text text-sm mb-2">Expert in high-load scalable backend systems</p>
                                    <a href="https://www.linkedin.com/in/gleb-ikonnikov/" target="_blank" rel="noopener noreferrer" className="text-blue-400 hover:text-blue-300 text-sm">LinkedIn</a>
                                </div>
                                <div className="bg-blue-900/20 p-4 rounded border-l-4 border-blue-500">
                                    <h3 className="font-bold custom-accent mb-2">Alisa Miroshnichenko – CPO</h3>
                                    <p className="custom-text text-sm mb-2">Product designer with UX for AI products</p>
                                    <a href="https://www.linkedin.com/in/alisa-miroshnichenko-a34269203/" target="_blank" rel="noopener noreferrer" className="text-blue-400 hover:text-blue-300 text-sm">LinkedIn</a>
                                </div>
                            </div>
                            <div className="space-y-4">
                                <div className="bg-green-900/20 p-4 rounded border-l-4 border-green-500">
                                    <h3 className="font-bold custom-accent mb-2">Pavel Sukmanov – Sales Manager</h3>
                                    <p className="custom-text text-sm mb-2">Onboarding non-technical business owners</p>
                                    <a href="https://www.linkedin.com/in/pavel-sukmanov-90b2932a8/" target="_blank" rel="noopener noreferrer" className="text-blue-400 hover:text-blue-300 text-sm">LinkedIn</a>
                                </div>
                                <div className="bg-orange-900/20 p-4 rounded border-l-4 border-orange-500">
                                    <h3 className="font-bold custom-accent mb-2">Eugene Anisei – Startup Advisor</h3>
                                    <p className="custom-text text-sm mb-2">Strategic advisor for growth & fundraising</p>
                                    <a href="https://www.linkedin.com/in/eugen-anisei/" target="_blank" rel="noopener noreferrer" className="text-blue-400 hover:text-blue-300 text-sm">LinkedIn</a>
                                </div>
                            </div>
                        </div>
                    )
                },
                {
                    title: "12. Vision & Closing",
                    content: (
                        <div className="space-y-4 text-center">
                            <div className="flex items-center justify-center gap-3">
                                <div className="w-8 h-8 bg-purple-500 rounded-full flex items-center justify-center text-white font-bold">1</div>
                            <p className="custom-text text-lg">Zaico transforms how Gen Z gets things done</p>
                            </div>
                            <div className="flex items-center justify-center gap-3">
                                <div className="w-8 h-8 bg-purple-500 rounded-full flex items-center justify-center text-white font-bold">2</div>
                            <p className="custom-text">No stress, no awkward calls, no wasted time</p>
                            </div>
                            <div className="flex items-center justify-center gap-3">
                                <div className="w-8 h-8 bg-purple-500 rounded-full flex items-center justify-center text-white font-bold">3</div>
                            <p className="custom-text"><strong>Long-term: Zaico = AI operating system for real-world tasks</strong></p>
                            </div>
                            <div className="text-3xl font-bold custom-accent mt-8">
                                Zaico — Stop calling. Start living.
                            </div>
                        </div>
                    )
                }
            ];

            // Investors page
            if (currentStep === 'investors') {
                return (
                    <div className="min-h-screen custom-bg p-4">
                        <div className="max-w-6xl mx-auto">
                            {/* Header */}
                            <div className="text-center mb-8">
                                <button 
                                    className="custom-btn btn btn-sm mb-4"
                                    onClick={() => setCurrentStep('landing')}
                                >
                                    ← Back to Demo
                                </button>
                                <h1 className="text-4xl font-bold custom-accent mb-2">Zaico</h1>
                                <p className="text-xl custom-text-muted">Investor Pitch Deck</p>
                            </div>

                            {/* Slide Navigation */}
                            <div className="flex justify-center mb-6">
                                <div className="flex space-x-2">
                                    {slides.map((_, index) => (
                                        <button
                                            key={index}
                                            className={`w-3 h-3 rounded-full transition-colors ${
                                                index === currentSlide
                                                    ? 'bg-purple-500'
                                                    : 'bg-gray-600 hover:bg-gray-500'
                                            }`}
                                            onClick={() => goToSlide(index)}
                                        />
                                    ))}
                                </div>
                            </div>

                            {/* Current Slide */}
                            <div className="custom-card p-8 slide-up min-h-96 flex flex-col justify-center">
                                <h2 className="text-3xl font-bold custom-accent mb-6 text-center">
                                    {slides[currentSlide].title}
                                </h2>
                                <div className="flex-1">
                                    {slides[currentSlide].content}
                                </div>
                            </div>

                            {/* Navigation Buttons */}
                            <div className="flex justify-between items-center mt-8">
                                <button 
                                    className="custom-btn btn"
                                    onClick={prevSlide}
                                    disabled={currentSlide === 0}
                                >
                                    ← Previous
                                </button>
                                <div className="text-center">
                                    <span className="custom-text">{currentSlide + 1} of {slides.length}</span>
                                </div>
                                <button 
                                    className="custom-btn btn"
                                    onClick={nextSlide}
                                    disabled={currentSlide === slides.length - 1}
                                >
                                    Next →
                                </button>
                            </div>

                            {/* Back to Demo Button */}
                            <div className="text-center mt-8">
                                <button 
                                    className="custom-btn btn btn-lg"
                                    onClick={() => setCurrentStep('landing')}
                                >
                                    ← Back to Demo
                                </button>
                            </div>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen custom-bg flex items-center justify-center p-4">
                    <div className="w-full max-w-2xl">
                        <div className="custom-card rounded-2xl shadow-xl overflow-hidden">
                            {/* Header */}
                            <div className="custom-card border-b border-gray-600 p-4">
                                <div className="flex justify-between items-center">
                                    <div>
                                        <h1 className="text-xl font-bold custom-accent">
                                            Zaico
                                        </h1>
                                        <p className="text-sm custom-text-muted">ai concierge for Gen Z</p>
                                    </div>
                                    <div className="text-right">
                                        <div className="text-sm font-semibold custom-text">
                                            {userProfile.subscription.minutesRemaining} min left
                                        </div>
                                        <div className="text-xs custom-text-muted">
                                            {userProfile.personalInfo.phone || currentNumber}
                                            {!userProfile.personalInfo.phone && (
                                                <span className="text-orange-400 ml-1">(shared)</span>
                                            )}
                                        </div>
                                        <div className="flex gap-1 mt-1">
                                        <button 
                                                className="custom-btn btn btn-sm"
                                                onClick={() => setShowProfile(true)}
                                            >
                                                Profile
                                            </button>
                                            <button 
                                                className="custom-btn btn btn-sm"
                                            onClick={() => setShowUpgrade(true)}
                                        >
                                            Upgrade
                                        </button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            {/* Chat Messages */}
                            <div className="h-96 overflow-y-auto p-4 space-y-4 custom-bg">
                                {messages.map((message) => (
                                    <div key={message.id} className="fade-in">
                                        <div className={`chat ${message.type === 'user' ? 'chat-end' : 'chat-start'}`}>
                                            {message.type !== 'user' && (
                                                <div className="chat-image avatar">
                                                    <div className="w-10 rounded-full">
                                                        <img 
                                                            src="https://i.ibb.co/R4JLgLDz/download-4.png" 
                                                            alt="Zaico AI Assistant"
                                                            className="w-full h-full object-cover"
                                                        />
                                                    </div>
                                                </div>
                                            )}
                                            <div className={`chat-bubble ${message.type === 'user' ? 'custom-user-bubble' : 'custom-chat-bubble'}`}>
                                                {message.text}
                                            </div>
                                            <div className="chat-footer custom-text-muted text-xs">
                                                {message.timestamp.toLocaleTimeString()}
                                            </div>
                                        </div>
                                        {message.content && (
                                            <div className="mt-2 ml-12">
                                                {message.content}
                                            </div>
                                        )}
                                        {message.buttons && (
                                            <div className="mt-2 ml-12">
                                                {message.buttons}
                                            </div>
                                        )}
                                    </div>
                                ))}

                                {/* Typing Indicator */}
                                {isTyping && (
                                    <div className="chat chat-start fade-in">
                                        <div className="chat-image avatar">
                                            <div className="w-10 rounded-full">
                                                <img 
                                                    src="https://i.ibb.co/R4JLgLDz/download-4.png" 
                                                    alt="Zaico AI Assistant"
                                                    className="w-full h-full object-cover"
                                                />
                                            </div>
                                        </div>
                                        <div className="chat-bubble custom-chat-bubble">
                                            <div className="flex space-x-1">
                                                <div className="w-2 h-2 custom-accent rounded-full typing-animation"></div>
                                                <div className="w-2 h-2 custom-accent rounded-full typing-animation" style={{animationDelay: '0.2s'}}></div>
                                                <div className="w-2 h-2 custom-accent rounded-full typing-animation" style={{animationDelay: '0.4s'}}></div>
                                            </div>
                                        </div>
                                    </div>
                                )}




                                {/* Processing Indicator */}
                                {isProcessing && (
                                    <div className="custom-card shadow border slide-up">
                                        <div className="card-body">
                                            <div className="flex items-center gap-3">
                                                <span className="loading loading-spinner loading-md custom-accent"></span>
                                                <div>
                                                    <h4 className="font-semibold text-sm custom-text">Processing your request...</h4>
                                                    <p className="text-xs custom-text-muted">{processingStep}</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                )}





                                <div ref={messagesEndRef} />
                            </div>

                            {/* Custom Message Input - Always Visible */}
                            <div className="p-4 custom-card border-t border-gray-600">
                                <div className="flex gap-2">
                                    <input
                                        type="text"
                                        placeholder="Describe a problem that requires a phone call and we'll solve it"
                                        className="custom-input input input-bordered input-sm flex-1"
                                        value={customMessage}
                                        onChange={(e) => setCustomMessage(e.target.value)}
                                        onKeyPress={(e) => {
                                            if (e.key === 'Enter') {
                                                handleCustomMessage();
                                            }
                                        }}
                                    />
                                    <button 
                                        className="custom-btn btn btn-sm"
                                        onClick={handleCustomMessage}
                                        disabled={!customMessage.trim()}
                                    >
                                        Send
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>



                    {/* Call Transcription Modal */}
                    {showTranscription && transcriptionData && (
                        <div className="modal modal-open" style={{zIndex: 9999}}>
                            <div className="modal-backdrop" onClick={() => setShowTranscription(false)}></div>
                            <div className="modal-box max-w-2xl custom-card" style={{zIndex: 10000}}>
                                <h3 className="font-bold text-lg mb-4 custom-text">
                                    Call Recording - {transcriptionData.clinic}
                                </h3>
                                <div className="bg-gray-700 p-4 rounded-lg mb-4">
                                    <div className="flex justify-between items-center mb-2">
                                        <span className="text-sm font-semibold custom-text">Duration: {transcriptionData.duration} minutes</span>
                                        <span className="text-sm custom-text-muted">{currentNumber}</span>
                                    </div>
                                    <div className="text-sm custom-text">
                                        <strong>Transcription:</strong>
                                    </div>
                                </div>
                                <div className="bg-gray-800 p-4 rounded-lg max-h-96 overflow-y-auto">
                                    <div className="text-sm whitespace-pre-wrap custom-text leading-relaxed">
                                        {transcriptionData.transcription.split('\n').map((line, index) => {
                                            if (line.includes('AI Assistant:')) {
                                                return <div key={index} className="mb-2 p-2 bg-purple-900/30 rounded border-l-4 border-purple-500"><span className="font-semibold text-purple-300">AI Assistant:</span> {line.replace('AI Assistant:', '')}</div>;
                                            } else if (line.includes('[Clinic]') || line.includes('[Restaurant]') || line.includes('[Salon]') || line.includes('[Taxi]')) {
                                                return <div key={index} className="mb-2 p-2 bg-blue-900/30 rounded border-l-4 border-blue-500"><span className="font-semibold text-blue-300">{line.split(':')[0]}:</span> {line.split(':').slice(1).join(':')}</div>;
                                            } else if (line.includes('[Call started') || line.includes('[Call ended')) {
                                                return <div key={index} className="text-xs custom-text-muted italic text-center my-2">{line}</div>;
                                            } else if (line.trim() === '') {
                                                return <div key={index} className="h-2"></div>;
                                            } else {
                                                return <div key={index} className="text-sm custom-text">{line}</div>;
                                            }
                                        })}
                                    </div>
                                </div>
                                <div className="modal-action">
                                    <button 
                                        className="custom-btn btn"
                                        onClick={() => setShowTranscription(false)}
                                    >
                                        Close
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Upgrade Modal */}
                    {showUpgrade && (
                        <div className="modal modal-open">
                            <div className="modal-box custom-card max-w-2xl">
                                <h3 className="font-bold text-lg mb-4 custom-text">
                                    Buy Minutes & Phone Number
                                </h3>
                                
                                <div className="space-y-4">
                                    {/* Current Status */}
                                    <div className="custom-card border border-blue-500">
                                        <div className="card-body">
                                            <div className="flex items-center gap-3">
                                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" className="stroke-current shrink-0 w-6 h-6 text-blue-400">
                                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                                </svg>
                                                <div>
                                                    <h4 className="font-bold custom-text">Current Status</h4>
                                                    <p className="text-sm custom-text-muted">{remainingMinutes} minutes left on {currentNumber}</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    {/* Minutes Packages */}
                                    <div>
                                        <h4 className="font-bold custom-text mb-3">Buy Minutes (Top-up)</h4>
                                        <div className="grid grid-cols-2 gap-3">
                                            <div className="custom-card border border-gray-600 cursor-pointer hover:border-purple-500 transition-colors" onClick={() => {
                                                const newMinutes = remainingMinutes + 5;
                                                setRemainingMinutes(newMinutes);
                                                setUserProfile(prev => ({
                                                    ...prev,
                                                    subscription: {
                                                        ...prev.subscription,
                                                        minutesRemaining: newMinutes
                                                    }
                                                }));
                                                setShowUpgrade(false);
                                                showPaymentSuccess("Added 5 minutes to your account! You now have " + newMinutes + " minutes left.");
                                            }}>
                                                <div className="card-body p-3 text-center">
                                                    <div className="text-lg font-bold custom-accent">5 min</div>
                                                    <div className="text-sm custom-text">$4.49</div>
                                                </div>
                                            </div>
                                            <div className="custom-card border border-gray-600 cursor-pointer hover:border-purple-500 transition-colors" onClick={() => {
                                                const newMinutes = remainingMinutes + 10;
                                                setRemainingMinutes(newMinutes);
                                                setUserProfile(prev => ({
                                                    ...prev,
                                                    subscription: {
                                                        ...prev.subscription,
                                                        minutesRemaining: newMinutes
                                                    }
                                                }));
                                                setShowUpgrade(false);
                                                showPaymentSuccess("Added 10 minutes to your account! You now have " + newMinutes + " minutes left.");
                                            }}>
                                                <div className="card-body p-3 text-center">
                                                    <div className="text-lg font-bold custom-accent">10 min</div>
                                                    <div className="text-sm custom-text">$7.49</div>
                                                </div>
                                            </div>
                                            <div className="custom-card border border-gray-600 cursor-pointer hover:border-purple-500 transition-colors" onClick={() => {
                                                const newMinutes = remainingMinutes + 15;
                                                setRemainingMinutes(newMinutes);
                                                setUserProfile(prev => ({
                                                    ...prev,
                                                    subscription: {
                                                        ...prev.subscription,
                                                        minutesRemaining: newMinutes
                                                    }
                                                }));
                                                setShowUpgrade(false);
                                                showPaymentSuccess("Added 15 minutes to your account! You now have " + newMinutes + " minutes left.");
                                            }}>
                                                <div className="card-body p-3 text-center">
                                                    <div className="text-lg font-bold custom-accent">15 min</div>
                                                    <div className="text-sm custom-text">$10.49</div>
                                                </div>
                                            </div>
                                            <div className="custom-card border border-purple-500 cursor-pointer hover:border-purple-400 transition-colors relative" onClick={() => {
                                                const newMinutes = remainingMinutes + 50;
                                                setRemainingMinutes(newMinutes);
                                                setUserProfile(prev => ({
                                                    ...prev,
                                                    subscription: {
                                                        ...prev.subscription,
                                                        minutesRemaining: newMinutes
                                                    }
                                                }));
                                                setShowUpgrade(false);
                                                showPaymentSuccess("Added 50 minutes to your account! You now have " + newMinutes + " minutes left. Great value!");
                                            }}>
                                                <div className="absolute -top-2 -right-2 bg-purple-500 text-white text-xs px-2 py-1 rounded-full">
                                                    Best Value
                                                </div>
                                                <div className="card-body p-3 text-center">
                                                    <div className="text-lg font-bold custom-accent">50 min</div>
                                                    <div className="text-sm custom-text">$29.99</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    {/* Personal Number */}
                                    <div>
                                        <h4 className="font-bold custom-text mb-3">Personal Virtual Number</h4>
                                        <div className="custom-card border border-purple-500">
                                            <div className="card-body">
                                                <div className="flex justify-between items-center mb-3">
                                                    <div>
                                                        <h4 className="card-title custom-accent">Virtual Number</h4>
                                                        <p className="text-sm custom-text-muted">Personal number for SMS & calls</p>
                                                    </div>
                                                    <div className="text-right">
                                                        <div className="text-2xl font-bold custom-accent">$14.99</div>
                                                        <div className="text-xs custom-text-muted">one-time</div>
                                                    </div>
                                                </div>
                                                <div className="space-y-2 mb-4">
                                                    <div className="custom-text text-sm">
                                                        ✓ Personal virtual number
                                                    </div>
                                                    <div className="custom-text text-sm">
                                                        ✓ Receive SMS (banks, services, auth)
                                                    </div>
                                                    <div className="custom-text text-sm">
                                                        ✓ Incoming calls (couriers, clients)
                                                    </div>
                                                    <div className="custom-text text-sm">
                                                        ✓ Compatible with AI concierge
                                                    </div>
                                                </div>
                                                <button 
                                                    className="custom-btn btn w-full"
                                                    onClick={() => {
                                                        const newNumber = '+1 (555) ' + Math.floor(Math.random() * 900 + 100) + '-' + Math.floor(Math.random() * 9000 + 1000);
                                                        const currentMinutes = remainingMinutes;
                                                        const newMinutes = currentMinutes + 10; // Keep existing + add 10
                                                        
                                                        setCurrentNumber(newNumber);
                                                        setRemainingMinutes(newMinutes);
                                                        setShowUpgrade(false);
                                                        
                                                        // Update user profile with personal number and subscription
                                                        setUserProfile(prev => ({
                                                            ...prev,
                                                            personalInfo: {
                                                                ...prev.personalInfo,
                                                                phone: newNumber
                                                            },
                                                            subscription: {
                                                                ...prev.subscription,
                                                                plan: 'Personal',
                                                                minutesRemaining: newMinutes,
                                                                minutesUsed: prev.subscription.minutesUsed // Keep existing usage
                                                            }
                                                        }));
                                                        
                                                        showPaymentSuccess("Congratulations! You now have your own personal number: " + newNumber + ". You can receive SMS and calls, plus " + newMinutes + " AI concierge minutes!");
                                                    }}
                                                >
                                                    Buy Virtual Number
                                                </button>
                                            </div>
                                        </div>
                                    </div>

                                    {/* AI Concierge Subscriptions */}
                                    <div>
                                        <h4 className="font-bold custom-text mb-3">AI Concierge Subscriptions</h4>
                                        <div className="space-y-3">
                                            {/* Basic Plan */}
                                            <div className="custom-card border border-gray-600">
                                                <div className="card-body">
                                                    <div className="flex justify-between items-center mb-3">
                                                        <div>
                                                            <h4 className="card-title custom-text">Basic</h4>
                                                            <p className="text-sm custom-text-muted">AI answers when you're busy</p>
                                                        </div>
                                                        <div className="text-right">
                                                            <div className="text-xl font-bold custom-text">$9.99</div>
                                                            <div className="text-xs custom-text-muted">/month</div>
                                                        </div>
                                                    </div>
                                                    <div className="space-y-1 mb-3">
                                                        <div className="custom-text text-sm">✓ AI answers calls when busy</div>
                                                        <div className="custom-text text-sm">✓ Voice auto-replies + SMS forwarding</div>
                                                        <div className="custom-text text-sm">✓ Perfect for couriers & personal tasks</div>
                                                    </div>
                                                    <button 
                                                        className="custom-btn btn btn-sm w-full"
                                                        onClick={() => {
                                                            setShowUpgrade(false);
                                                            addMessageWithTyping("Great choice! Basic AI Concierge plan activated for $9.99/month. AI will now handle your calls when you're busy!");
                                                        }}
                                                    >
                                                        Subscribe Basic
                                                    </button>
                                                </div>
                                            </div>

                                            {/* Pro Plan */}
                                            <div className="custom-card border border-purple-500 relative">
                                                <div className="absolute -top-2 -right-2 bg-purple-500 text-white text-xs px-2 py-1 rounded-full">
                                                    Popular
                                                </div>
                                                <div className="card-body">
                                                    <div className="flex justify-between items-center mb-3">
                                                        <div>
                                                            <h4 className="card-title custom-accent">Pro</h4>
                                                            <p className="text-sm custom-text-muted">Smart call sorting + recording</p>
                                                        </div>
                                                        <div className="text-right">
                                                            <div className="text-xl font-bold custom-accent">$19.99</div>
                                                            <div className="text-xs custom-text-muted">/month</div>
                                                        </div>
                                                    </div>
                                                    <div className="space-y-1 mb-3">
                                                        <div className="custom-text text-sm">✓ Everything in Basic</div>
                                                        <div className="custom-text text-sm">✓ Smart call sorting (important/spam)</div>
                                                        <div className="custom-text text-sm">✓ Call recording + transcription</div>
                                                        <div className="custom-text text-sm">✓ Priority support</div>
                                                    </div>
                                                    <button 
                                                        className="custom-btn btn w-full"
                                                        onClick={() => {
                                                            setShowUpgrade(false);
                                                            addMessageWithTyping("Excellent! Pro AI Concierge plan activated for $19.99/month. You now have smart call sorting, recording, and priority support!");
                                                        }}
                                                    >
                                                        Subscribe Pro
                                                    </button>
                                                </div>
                                            </div>

                                            {/* Business Plan */}
                                            <div className="custom-card border border-gray-600">
                                                <div className="card-body">
                                                    <div className="flex justify-between items-center mb-3">
                                                        <div>
                                                            <h4 className="card-title custom-text">Business</h4>
                                                            <p className="text-sm custom-text-muted">Multiple numbers + CRM integration</p>
                                                        </div>
                                                        <div className="text-right">
                                                            <div className="text-xl font-bold custom-text">$29.99</div>
                                                            <div className="text-xs custom-text-muted">/month</div>
                                                        </div>
                                                    </div>
                                                    <div className="space-y-1 mb-3">
                                                        <div className="custom-text text-sm">✓ Everything in Pro</div>
                                                        <div className="custom-text text-sm">✓ Multiple virtual numbers</div>
                                                        <div className="custom-text text-sm">✓ CRM & messenger integration</div>
                                                        <div className="custom-text text-sm">✓ Advanced AI scenarios</div>
                                                    </div>
                                                    <button 
                                                        className="custom-btn btn btn-sm w-full"
                                                        onClick={() => {
                                                            setShowUpgrade(false);
                                                            addMessageWithTyping("Perfect for business! Business AI Concierge plan activated for $29.99/month. You now have multiple numbers, CRM integration, and advanced AI scenarios!");
                                                        }}
                                                    >
                                                        Subscribe Business
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div className="modal-action">
                                    <button 
                                        className="custom-btn btn"
                                        onClick={() => setShowUpgrade(false)}
                                    >
                                        Close
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Profile Modal */}
                    {showProfile && (
                        <div className="modal modal-open">
                            <div className="modal-box max-w-2xl">
                                <h3 className="font-bold text-lg custom-text mb-4">Your Profile</h3>
                                
                                {/* Personal Information */}
                                <div className="mb-6">
                                    <h4 className="font-semibold custom-accent mb-3">Personal Information</h4>
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-3 text-sm">
                                        <div>
                                            <span className="custom-text-muted">Name:</span>
                                            <div className="custom-text font-medium">{userProfile.personalInfo.name || 'Not provided'}</div>
                                        </div>
                                        <div>
                                            <span className="custom-text-muted">Email:</span>
                                            <div className="custom-text font-medium">{userProfile.personalInfo.email || 'Not provided'}</div>
                                        </div>
                                        <div>
                                            <span className="custom-text-muted">Phone:</span>
                                            <div className="custom-text font-medium">{userProfile.personalInfo.phone || currentNumber}</div>
                                        </div>
                                        <div>
                                            <span className="custom-text-muted">Location:</span>
                                            <div className="custom-text font-medium">{userProfile.personalInfo.location || 'Not provided'}</div>
                                        </div>
                                    </div>
                                </div>
                                
                                {/* Payment Information */}
                                <div className="mb-6">
                                    <h4 className="font-semibold custom-accent mb-3">Payment Information</h4>
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-3 text-sm">
                                        <div>
                                            <span className="custom-text-muted">Card Number:</span>
                                            <div className="custom-text font-medium">
                                                {userProfile.paymentInfo.cardNumber ? 
                                                    '**** **** **** ' + userProfile.paymentInfo.cardNumber.slice(-4) : 
                                                    'Not provided'
                                                }
                                            </div>
                                        </div>
                                        <div>
                                            <span className="custom-text-muted">Expiry Date:</span>
                                            <div className="custom-text font-medium">{userProfile.paymentInfo.expiryDate || 'Not provided'}</div>
                                        </div>
                                        <div>
                                            <span className="custom-text-muted">Card Name:</span>
                                            <div className="custom-text font-medium">{userProfile.paymentInfo.cardName || 'Not provided'}</div>
                                        </div>
                                        <div>
                                            <span className="custom-text-muted">Billing Address:</span>
                                            <div className="custom-text font-medium">{userProfile.paymentInfo.billingAddress || 'Not provided'}</div>
                                        </div>
                                    </div>
                                </div>
                                
                                {/* Subscription Information */}
                                <div className="mb-6">
                                    <h4 className="font-semibold custom-accent mb-3">Subscription</h4>
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-3 text-sm">
                                        <div>
                                            <span className="custom-text-muted">Plan:</span>
                                            <div className="custom-text font-medium">{userProfile.subscription.plan}</div>
                                        </div>
                                        <div>
                                            <span className="custom-text-muted">Minutes Used:</span>
                                            <div className="custom-text font-medium">{userProfile.subscription.minutesUsed}</div>
                                        </div>
                                        <div>
                                            <span className="custom-text-muted">Minutes Remaining:</span>
                                            <div className="custom-text font-medium">{userProfile.subscription.minutesRemaining}</div>
                                        </div>
                                        <div>
                                            <span className="custom-text-muted">Next Billing:</span>
                                            <div className="custom-text font-medium">{userProfile.subscription.nextBilling}</div>
                                        </div>
                                    </div>
                                </div>
                                
                                {/* Service History */}
                                {userProfile.preferences.serviceHistory.length > 0 && (
                                    <div className="mb-6">
                                        <h4 className="font-semibold custom-accent mb-3">Service History</h4>
                                        <div className="space-y-2">
                                            {userProfile.preferences.serviceHistory.map((service, index) => (
                                                <div key={index} className="custom-card p-3 border border-gray-600">
                                                    <div className="flex justify-between items-start">
                                                        <div>
                                                            <div className="font-medium custom-text">{service.type}</div>
                                                            <div className="text-sm custom-text-muted">{service.provider}</div>
                                                            <div className="text-xs custom-text-muted">{service.date}</div>
                                                        </div>
                                                        <div className="text-right">
                                                            <div className="text-sm custom-accent font-medium">{service.price}</div>
                                                            <div className="text-xs custom-text-muted">{service.status}</div>
                                                        </div>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}
                                
                                <div className="modal-action">
                                    <button 
                                        className="custom-btn btn"
                                        onClick={() => setShowProfile(false)}
                                    >
                                        Close
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }


        // User Data Form Component
        function UserDataForm({ onSubmit }) {
            const [formData, setFormData] = useState({
                name: 'John Smith',
                email: 'john.smith@email.com',
                phone: '+1 (555) 123-4567',
                location: 'New York, NY'
            });

            const handleSubmit = (e) => {
                e.preventDefault();
                onSubmit(formData);
            };

            const handleChange = (field, value) => {
                setFormData(prev => ({ ...prev, [field]: value }));
            };

            return (
                <div className="custom-card shadow border slide-up">
                    <div className="card-body">
                        <h3 className="card-title text-sm custom-text">Contact Information</h3>
                        <div className="mb-4">
                            <div className="flex justify-between text-xs custom-text-muted mb-1">
                                <span>Step 1 of 2</span>
                                <span>50%</span>
                            </div>
                            <div className="w-full bg-gray-700 rounded-full h-2">
                                <div className="bg-purple-500 h-2 rounded-full transition-all duration-500" style={{width: '50%'}}></div>
                            </div>
                        </div>
                        <form onSubmit={handleSubmit} className="space-y-3">
                            <div className="form-control">
                                <label className="label">
                                    <span className="label-text text-xs custom-text">Name</span>
                                </label>
                                <input 
                                    type="text" 
                                    className="custom-input input input-bordered input-sm" 
                                    value={formData.name}
                                    onChange={(e) => handleChange('name', e.target.value)}
                                />
                            </div>
                            
                            <div className="form-control">
                                <label className="label">
                                    <span className="label-text text-xs custom-text">Email</span>
                                </label>
                                <input 
                                    type="email" 
                                    className="custom-input input input-bordered input-sm" 
                                    value={formData.email}
                                    onChange={(e) => handleChange('email', e.target.value)}
                                />
                            </div>
                            
                            <div className="form-control">
                                <label className="label">
                                    <span className="label-text text-xs custom-text">Phone</span>
                                </label>
                                <input 
                                    type="tel" 
                                    className="custom-input input input-bordered input-sm" 
                                    value={formData.phone}
                                    onChange={(e) => handleChange('phone', e.target.value)}
                                />
                            </div>
                            
                            <div className="form-control">
                                <label className="label">
                                    <span className="label-text text-xs custom-text">Location</span>
                                </label>
                                <input 
                                    type="text" 
                                    className="custom-input input input-bordered input-sm" 
                                    placeholder="Where do you need the service?"
                                    value={formData.location}
                                    onChange={(e) => handleChange('location', e.target.value)}
                                />
                            </div>
                            
                            
                            <button type="submit" className="custom-btn btn w-full">
                                Continue to Payment
                            </button>
                        </form>
                    </div>
                </div>
            );
        }

        // Payment Form Component
        function PaymentForm({ onSubmit }) {
            const [formData, setFormData] = useState({
                cardNumber: '4532 1234 5678 9012',
                cardExpiry: '12/25',
                cardCVV: '123',
                cardName: 'JOHN SMITH'
            });

            const handleSubmit = (e) => {
                e.preventDefault();
                onSubmit(formData);
            };

            const handleChange = (field, value) => {
                setFormData(prev => ({ ...prev, [field]: value }));
            };

            return (
                <div className="custom-card shadow border slide-up">
                    <div className="card-body">
                        <h3 className="card-title text-sm custom-text">Payment Information</h3>
                        <div className="mb-4">
                            <div className="flex justify-between text-xs custom-text-muted mb-1">
                                <span>Step 2 of 2</span>
                                <span>100%</span>
                            </div>
                            <div className="w-full bg-gray-700 rounded-full h-2">
                                <div className="bg-purple-500 h-2 rounded-full transition-all duration-500" style={{width: '100%'}}></div>
                            </div>
                        </div>
                        <form onSubmit={handleSubmit} className="space-y-3">
                            <div className="form-control">
                                <label className="label">
                                    <span className="label-text text-xs custom-text">Card Number</span>
                                </label>
                                <input 
                                    type="text" 
                                    className="custom-input input input-bordered input-sm" 
                                    placeholder="1234 5678 9012 3456"
                                    value={formData.cardNumber}
                                    onChange={(e) => {
                                        let value = e.target.value.replace(/\s/g, '').replace(/[^0-9]/gi, '');
                                        let formattedValue = value.match(/.{1,4}/g)?.join(' ') || value;
                                        handleChange('cardNumber', formattedValue);
                                    }}
                                    maxLength="19"
                                />
                            </div>

                            <div className="grid grid-cols-2 gap-2">
                                <div className="form-control">
                                    <label className="label">
                                        <span className="label-text text-xs custom-text">Expiry Date</span>
                                    </label>
                                    <input 
                                        type="text" 
                                        className="custom-input input input-bordered input-sm" 
                                        placeholder="MM/YY"
                                        value={formData.cardExpiry}
                                        onChange={(e) => {
                                            let value = e.target.value.replace(/\D/g, '');
                                            if (value.length >= 2) {
                                                value = value.substring(0, 2) + '/' + value.substring(2, 4);
                                            }
                                            handleChange('cardExpiry', value);
                                        }}
                                        maxLength="5"
                                    />
                                </div>
                                
                                <div className="form-control">
                                    <label className="label">
                                        <span className="label-text text-xs custom-text">CVV</span>
                                    </label>
                                    <input 
                                        type="text" 
                                        className="custom-input input input-bordered input-sm" 
                                        placeholder="123"
                                        value={formData.cardCVV}
                                        onChange={(e) => {
                                            let value = e.target.value.replace(/\D/g, '');
                                            handleChange('cardCVV', value);
                                        }}
                                        maxLength="3"
                                    />
                                </div>
                            </div>

                            <div className="form-control">
                                <label className="label">
                                    <span className="label-text text-xs custom-text">Cardholder Name</span>
                                </label>
                                <input 
                                    type="text" 
                                    className="custom-input input input-bordered input-sm" 
                                    placeholder="JOHN SMITH"
                                    value={formData.cardName}
                                    onChange={(e) => handleChange('cardName', e.target.value.toUpperCase())}
                                />
                            </div>
                            
                            <button type="submit" className="custom-btn btn w-full">
                                Complete Booking
                            </button>
                        </form>
                    </div>
                </div>
            );
        }

        // Render the app
        try {
            ReactDOM.render(<ZaicoChatbot />, document.getElementById('root'));
        } catch (error) {
            console.error('React render error:', error);
            document.getElementById('root').innerHTML = '<div style="color: white; padding: 20px; text-align: center;"><h1>Error loading app</h1><p>Check console for details</p></div>';
        }
    </script>
</body>
</html>

